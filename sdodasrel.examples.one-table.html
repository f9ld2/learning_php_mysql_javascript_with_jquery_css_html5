---
layout: default
---

  <h2 class="title">One-table examples</h2>
  <p class="para">
   The following set of examples all use the Relational DAS to work with 
   a data graph containing just one application data object, a single 
   company and the data just to be found the company table. These examples 
   do not exercise the power of SDO or the Relational DAS and of course 
   the same result could be achieved more economically with direct SQL 
   statements but they are intended to illustrate how to work with the 
   Relational DAS.
  </p>

  <p class="para">
   For this very simple scenario it would be possible to simplify the 
   database metadata to include just the company table - if that were done
   the second and third arguments to the constructor and the column 
   specifier used in the query example would become optional.
  </p>

  <p class="para">
   <div class="example" id="example-6321">
    <p><strong>Example #1 Creating a data object</strong></p>
    <div class="example-contents"><p>
     The simplest example is that of creating a single data object and 
     writing it to the database. In this example a single company object 
     is created, its name is set to &apos;Acme&apos;, and the Relational DAS is 
     called to write the changes to the database. The company name is 
     set here using the property name method. See the
     <a href="sdo.examples.html" class="link">Examples</a>
     section on the SDO extension for other ways of accessing the 
     properties of an object.
    </p></div>

    <div class="example-contents"><p>
     Data objects can only be created when you have a data object to 
     start with, however. It is for that reason that the first call 
     to the Relational DAS here is to obtain a root object. This is 
     in effect how to ask for an empty data graph - the special root 
     object is the true root of the tree. The company data object is 
     then created with a call to
     <span class="function"><strong>createDataObject()</strong></span>
     on the root object. This creates the company data object and inserts 
     it in the graph by inserting into a multi-valued containment property 
     on the root object called &apos;company&apos;.
    </p></div>
    <div class="example-contents"><p>
     When the Relational DAS is called to apply the changes a simple 
     insert statement &apos;INSERT INTO company (name) VALUES (&quot;Acme&quot;);&apos; 
     will be constructed and executed. The auto-generated primary key 
     will be set into the data object and the change summary will be reset, 
     so that it would be possible to continue working with the same data 
     object, modify it, and apply the newer changes a second time.
    </p></div>
                      
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">require_once&#xA0;</span><span style="color: #DD0000">&apos;SDO/DAS/Relational.php&apos;</span><span style="color: #007700">;<br>require_once&#xA0;</span><span style="color: #DD0000">&apos;company_metadata.inc.php&apos;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Construct&#xA0;the&#xA0;DAS&#xA0;with&#xA0;the&#xA0;metadata<br>***************************************************************/<br></span><span style="color: #0000BB">$das&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">SDO_DAS_Relational&#xA0;</span><span style="color: #007700">(</span><span style="color: #0000BB">$database_metadata</span><span style="color: #007700">,</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">,</span><span style="color: #0000BB">$SDO_containment_metadata</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Obtain&#xA0;a&#xA0;root&#xA0;object&#xA0;and&#xA0;create&#xA0;a&#xA0;company&#xA0;object&#xA0;underneath.<br>*&#xA0;Make&#xA0;a&#xA0;simple&#xA0;change&#xA0;to&#xA0;the&#xA0;data&#xA0;object.&#xA0;<br>***************************************************************/<br></span><span style="color: #0000BB">$root&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$das&#xA0;&#xA0;</span><span style="color: #007700">-&gt;&#xA0;</span><span style="color: #0000BB">createRootDataObject</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$acme&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$root&#xA0;</span><span style="color: #007700">-&gt;&#xA0;</span><span style="color: #0000BB">createDataObject</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$acme</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;Acme&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Get&#xA0;a&#xA0;database&#xA0;connection&#xA0;and&#xA0;write&#xA0;the&#xA0;object&#xA0;to&#xA0;the&#xA0;database<br>***************************************************************/<br></span><span style="color: #0000BB">$dbh&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$das&#xA0;</span><span style="color: #007700">-&gt;&#xA0;</span><span style="color: #0000BB">applyChanges</span><span style="color: #007700">(</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$root</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-6322">
    <p><strong>Example #2 Retrieving a data object</strong></p>
    <div class="example-contents"><p>
     In this example a single data object is retrieved from the database 
     - or possibly more than one if there is more than one company 
     called &apos;Acme&apos;. For each company returned, the
     <var class="varname"><var class="varname">name</var></var>
     and
     <var class="varname"><var class="varname">id</var></var>
     properties are echoed.
    </p></div>
    <div class="example-contents"><p>
     In this example the third argument to
     <span class="function"><strong>executeQuery()</strong></span>,
     the column specifier is needed as there are other tables in the 
     metadata with column names of
     <var class="varname"><var class="varname">name</var></var>
     and
     <var class="varname"><var class="varname">id</var></var>.
     If there were no possible ambiguity it could be omitted.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">require_once&#xA0;</span><span style="color: #DD0000">&apos;SDO/DAS/Relational.php&apos;</span><span style="color: #007700">;<br>require_once&#xA0;</span><span style="color: #DD0000">&apos;company_metadata.inc.php&apos;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Construct&#xA0;the&#xA0;DAS&#xA0;with&#xA0;the&#xA0;metadata<br>***************************************************************/<br></span><span style="color: #0000BB">$das&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">SDO_DAS_Relational&#xA0;</span><span style="color: #007700">(</span><span style="color: #0000BB">$database_metadata</span><span style="color: #007700">,</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">,</span><span style="color: #0000BB">$SDO_containment_metadata</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Get&#xA0;a&#xA0;database&#xA0;connection<br>***************************************************************/<br></span><span style="color: #0000BB">$dbh&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Issue&#xA0;a&#xA0;query&#xA0;to&#xA0;obtain&#xA0;a&#xA0;company&#xA0;object&#xA0;-&#xA0;possibly&#xA0;more&#xA0;if&#xA0;they&#xA0;exist<br>***************************************************************/<br></span><span style="color: #0000BB">$root&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$das</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">executeQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&apos;select&#xA0;name,&#xA0;id&#xA0;from&#xA0;company&#xA0;where&#xA0;name=&quot;Acme&quot;&apos;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;array(</span><span style="color: #DD0000">&apos;company.name&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;company.id&apos;</span><span style="color: #007700">)&#xA0;);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Echo&#xA0;name&#xA0;and&#xA0;id&#xA0;<br>***************************************************************/<br></span><span style="color: #007700">foreach&#xA0;(</span><span style="color: #0000BB">$root</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">]&#xA0;as&#xA0;</span><span style="color: #0000BB">$company</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Company&#xA0;obtained&#xA0;from&#xA0;the&#xA0;database&#xA0;has&#xA0;name&#xA0;=&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;<br>&#xA0;&#xA0;</span><span style="color: #0000BB">$company</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;name&apos;</span><span style="color: #007700">]&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;&#xA0;and&#xA0;id&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$company</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;id&apos;</span><span style="color: #007700">]&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-6323">
    <p><strong>Example #3 Updating a data object</strong></p>
    <div class="example-contents"><p>
     This example combines the previous two, in the sense that in order 
     to be updated the object must first be retrieved. The application 
     code reverses the company name (so &apos;Acme&apos; becomes &apos;emcA&apos;) and then the
     changes are written back to the database in the same way that they 
     were when the object was created. Because the query searches for 
     the name both ways round the program can be run repeatedly to find 
     the company and reverse its name each time.
    </p></div>
    <div class="example-contents"><p>
     In this example the same instance of the Relational DAS is reused 
     for the
     <span class="function"><strong>applyChanges()</strong></span>,
     as is the PDO database handle. This is quite alright; it also 
     alright to allow the previous instances to be garbage collected 
     and to obtain new instances. No state data regarding the graph 
     is held the Relational DAS once it has returned a data graph to 
     the application. All necessary data is either within the graph itself, 
     or can be reconstructed from the metadata.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">require_once&#xA0;</span><span style="color: #DD0000">&apos;SDO/DAS/Relational.php&apos;</span><span style="color: #007700">;<br>require_once&#xA0;</span><span style="color: #DD0000">&apos;company_metadata.inc.php&apos;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Construct&#xA0;the&#xA0;DAS&#xA0;with&#xA0;the&#xA0;metadata<br>***************************************************************/<br></span><span style="color: #0000BB">$das&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">SDO_DAS_Relational&#xA0;</span><span style="color: #007700">(</span><span style="color: #0000BB">$database_metadata</span><span style="color: #007700">,</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">,</span><span style="color: #0000BB">$SDO_containment_metadata</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Get&#xA0;a&#xA0;database&#xA0;connection<br>***************************************************************/<br></span><span style="color: #0000BB">$dbh&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Issue&#xA0;a&#xA0;query&#xA0;to&#xA0;obtain&#xA0;a&#xA0;company&#xA0;object&#xA0;-&#xA0;possibly&#xA0;more&#xA0;if&#xA0;they&#xA0;exist<br>***************************************************************/<br></span><span style="color: #0000BB">$root&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$das</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">executeQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">,<br>&#xA0;&#xA0;</span><span style="color: #DD0000">&apos;select&#xA0;name,&#xA0;id&#xA0;from&#xA0;company&#xA0;where&#xA0;name=&quot;Acme&quot;&#xA0;or&#xA0;name=&quot;emcA&quot;&apos;</span><span style="color: #007700">,<br>&#xA0;&#xA0;array(</span><span style="color: #DD0000">&apos;company.name&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;company.id&apos;</span><span style="color: #007700">)&#xA0;);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Alter&#xA0;the&#xA0;name&#xA0;of&#xA0;just&#xA0;the&#xA0;first&#xA0;company<br>***************************************************************/<br></span><span style="color: #0000BB">$company&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$root</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br>echo&#xA0;</span><span style="color: #DD0000">&quot;obtained&#xA0;a&#xA0;company&#xA0;with&#xA0;name&#xA0;of&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$company</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$company</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">strrev</span><span style="color: #007700">(</span><span style="color: #0000BB">$company</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">name</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Write&#xA0;the&#xA0;change&#xA0;back<br>***************************************************************/<br></span><span style="color: #0000BB">$das</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">applyChanges</span><span style="color: #007700">(</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">,</span><span style="color: #0000BB">$root</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

  <p class="para">
   <div class="example" id="example-6324">
    <p><strong>Example #4 Deleting a data object</strong></p>
    <div class="example-contents"><p>
     Any companies called &apos;Acme&apos; or its reverse &apos;emcA&apos; are retrieved.
     They are then all deleted from the graph with unset.
    </p></div>

    <div class="example-contents"><p>
     In this example they are all deleted in one go by unsetting the 
     containing property (the property defining the containment 
     relationship). It is also possible to delete them individually.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">require_once&#xA0;</span><span style="color: #DD0000">&apos;SDO/DAS/Relational.php&apos;</span><span style="color: #007700">;<br>require_once&#xA0;</span><span style="color: #DD0000">&apos;company_metadata.inc.php&apos;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Construct&#xA0;the&#xA0;DAS&#xA0;with&#xA0;the&#xA0;metadata<br>***************************************************************/<br></span><span style="color: #0000BB">$das&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">SDO_DAS_Relational&#xA0;</span><span style="color: #007700">(</span><span style="color: #0000BB">$database_metadata</span><span style="color: #007700">,</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">,</span><span style="color: #0000BB">$SDO_containment_metadata</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Get&#xA0;a&#xA0;database&#xA0;connection<br>***************************************************************/<br></span><span style="color: #0000BB">$dbh&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">PDO</span><span style="color: #007700">(</span><span style="color: #0000BB">PDO_DSN</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_USER</span><span style="color: #007700">,</span><span style="color: #0000BB">DATABASE_PASSWORD</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Issue&#xA0;a&#xA0;query&#xA0;to&#xA0;obtain&#xA0;a&#xA0;company&#xA0;object&#xA0;-&#xA0;possibly&#xA0;more&#xA0;if&#xA0;they&#xA0;exist<br>***************************************************************/<br></span><span style="color: #0000BB">$root&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$das</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">executeQuery</span><span style="color: #007700">(</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">,<br>&#xA0;&#xA0;</span><span style="color: #DD0000">&apos;select&#xA0;name,&#xA0;id&#xA0;from&#xA0;company&#xA0;where&#xA0;name=&quot;Acme&quot;&#xA0;or&#xA0;name=&quot;emcA&quot;&apos;</span><span style="color: #007700">,<br>&#xA0;&#xA0;array(</span><span style="color: #DD0000">&apos;company.name&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;company.id&apos;</span><span style="color: #007700">)&#xA0;);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Delete&#xA0;any&#xA0;companies&#xA0;found&#xA0;from&#xA0;the&#xA0;data&#xA0;graph<br>***************************************************************/<br></span><span style="color: #007700">unset(</span><span style="color: #0000BB">$root</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;company&apos;</span><span style="color: #007700">]);<br><br></span><span style="color: #FF8000">/**************************************************************<br>*&#xA0;Write&#xA0;the&#xA0;change(s)&#xA0;back<br>***************************************************************/<br></span><span style="color: #0000BB">$das</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">applyChanges</span><span style="color: #007700">(</span><span style="color: #0000BB">$dbh</span><span style="color: #007700">,</span><span style="color: #0000BB">$root</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>

 