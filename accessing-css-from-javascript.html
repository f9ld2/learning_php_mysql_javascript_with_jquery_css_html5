---
layout: default
title: "Accessing CSS from JavaScript"
---
<h2>Accessing CSS from JavaScript</h2>
<span>With a good understanding of the DOM and CSS now under your belt, you&rsquo;ll learn in</span>
<span>this chapter how to access both the DOM and CSS directly from JavaScript, enabling</span>
<span>you to create highly dynamic and responsive websites.</span>

<span>I&rsquo;ll also show you how to use interrupts so you can create animations or provide any</span>
<span>code that must continue running (such as a clock). Finally, I&rsquo;ll explain how you can</span>
<span>add new elements to or remove existing ones from the DOM so you don&rsquo;t have to</span>
<span>pre-create elements in HTML just in case JavaScript may need to access them later.</span>
<h3>Revisiting the getElementById Function</h3>
<span>To help with the examples in the rest of this book, I would like to provide an</span>
<span>enhanced version of the</span>
<span>getElementbyId</span>
<span>function, for handling DOM elements and</span>
<span>CSS styles quickly and efficiently, without the need for including a framework such as</span>
<span>jQuery.</span>

<span>However, to avoid conflicting with frameworks that use the</span>
<span>$</span>
<span>character, I&rsquo;ll use the</span>
<span>uppercase</span>
<span>O</span>
<span>, since it&rsquo;s the first letter of</span>
<span>Object</span>
<span>, which is what will be returned when</span>
<span>the function is called (the object represented by the ID passed to the function).</span>
<h4>The O function</h4>
<span>Here&rsquo;s what the bare-bones</span>
<span>O</span>
<span>function looks like:</span>

<span>function O(i)</span>
<span>{</span>
<span>return document.getElementById(i)</span>
<span>}</span>

<span>This alone saves 22 characters of typing each time it&rsquo;s called. But I choose to extend</span>
<span>the function a little by allowing either an ID name or an object to be passed to this</span>
<span>function, as shown in the complete version of the function in</span>
<span>Example 20-1</span>
<span>.</span>

<span>Example 20-1.</span>
<span>The O() function</span>
<span>function O(i)</span>
<span>{</span>
<span>return typeof i == 'object' ? i : document.getElementById(i)</span>
<span>}</span>

<span>If an object is passed to the function, it just returns that object back again. Otherwise,</span>
<span>it assumes that an ID is passed and returns the object to which the ID refers.</span>

<span>But why on earth would I want to add this first statement, which simply returns the</span>
<span>object passed to it?</span>
<h4>The S Function</h4>
<span>The answer to this question becomes clear when you look at a partner function called</span>
<span>S</span>
<span>, which gives you easy access to the</span>
<span>style</span>
<span>(or CSS) properties of an object, as shown</span>
<span>in</span>
<span>Example 20-2</span>
<span>.</span>

<span>Example 20-2.</span>
<span>The S() function</span>

<span>function S(i)</span>
<span>{</span>
<span>return O(i).style</span>
<span>}</span>

<span>The</span>
<span>S</span>
<span>in this function name is the first letter of</span>
<span>Style</span>
<span>, and the function performs the</span>
<span>task of returning the</span>
<span>style</span>
<span>property (or subobject) of the element referred to.</span>
<span>Because the embedded</span>
<span>O</span>
<span>function accepts either an ID or an object, you can pass</span>
<span>either an ID or an object to</span>
<span>S</span>
<span>as well.</span>

<span>Let&rsquo;s look at what&rsquo;s going on here by taking a</span>
<span>&lt;div&gt;</span>
<span>element with the ID of</span>
<span>myobj</span>
<span>and</span>
<span>setting its text color to green, like this:</span>

<span>&lt;div id='myobj'&gt;Some text&lt;/div&gt;</span>
<span>&lt;script&gt;</span>
<span>O('myobj').style.color = 'green'</span>
<span>&lt;/script&gt;</span>

<span>The preceding code will do the job, but it&rsquo;s much simpler to call the new</span>
<span>S</span>
<span>function,</span>
<span>like this:</span>

<span>S('myobj').color = 'green'</span>

<span>Now consider the case in which the object returned by calling</span>
<span>O</span>
<span>is stored in, for</span>
<span>example, an object called</span>
<span>fred</span>
<span>, like this:</span>

<span>fred = O('myobj')</span>

<span>Because of the way function</span>
<span>S</span>
<span>works, we can still call it to change the text color to</span>
<span>green, like this:</span>

<span>S(fred).color = 'green'</span>

<span>This means that whether you wish to access an object directly or via its ID, you can</span>
<span>do so by passing it to either the</span>
<span>O</span>
<span>or</span>
<span>S</span>
<span>function as required. Just remember that when</span>
<span>you pass an object (rather than an ID), you must not place it in quotation marks.</span>
<h4>The C Function</h4>
<span>So far I&rsquo;ve provided you with two simple functions that make it easy for you to access</span>
<span>any element on a web page, and any</span>
<span>style</span>
<span>property of an element. Sometimes,</span>
<span>though, you will want to access more than one element at a time, and you can do this</span>
<span>by assigning a CSS class name to each such element, like these examples, which both</span>
<span>employ the class</span>
<span>myclass</span>
<span>:</span>

<span>&lt;div class='myclass'&gt;Div contents&lt;/fiv&gt;</span>
<span>&lt;p class='myclass'&gt;Paragraph contents&lt;/p&gt;</span>

<span>If you want to access all elements on a page that use a particular class, you can use the</span>
<span>C</span>
<span>function (for the first letter of</span>
<span>Class</span>
<span>), shown in</span>
<span>&nbsp;Example 20-3</span>
<span>, to return an array</span>
<span>containing all the objects that match a class name provided.</span>

<span>Example 20-3.</span>
<span>The C() function</span>

<span>function C(i)</span>
<span>{</span>
<span>return document.getElementsByClassName(i)</span>
<span>}</span>

<span>To use this function, simply call it as follows, saving the returned array so that you</span>
<span>can access each of the elements individually as required or (more likely to be the case)</span>
<span>en masse via a loop:</span>

<span>myarray = C('myclass')</span>

<span>Now you can do whatever you like with the objects returned, such as (for example)</span>
<span>setting their</span>
<span>textDecoration</span>
<span>style property to</span>
<span>underline</span>
<span>, as follows:</span>
<span>for (i = 0 ; i &lt; myarray.length ; ++i)</span>
<span>S(myarray[i]).textDecoration = 'underline'</span>
<span>This code iterates through the objects in</span>
<span>myarray[]</span>
<span>and then uses the</span>
<span>S</span>
<span>function to</span>
<span>reference each one&rsquo;s style property, setting its</span>
<span>textDecoration</span>
<span>property to</span>
<span>underline</span>
<span>.</span>
<h4>Including the Functions</h4>
<span>I use the</span>
<span>O</span>
<span>and</span>
<span>S</span>
<span>functions in the examples for the remainder of this chapter, as they</span>
<span>make the code shorter and easier to follow. Therefore, I have saved them in the file</span>
<span>OSC.js</span>
<span>&nbsp;(along with the</span>
<span>C</span>
<span>function, as I think you&rsquo;ll find it extremely useful) in the</span>
<span>Chapter 20</span>
<span>&nbsp;folder of the accompanying archive of examples, freely downloadable</span>
<span>from the</span>
<span>http://lpmj.net</span>
<span>website.</span>
<span>You can include these functions in any web page by using the following statement&mdash;</span>
<span>preferably in its</span>
<span>&lt;head&gt;</span>
<span>section, anywhere before any script that relies on calling</span>
<span>them:</span>
<span>&lt;script src='OSC.js'&gt;&lt;/script&gt;</span>
<span>The contents of</span>
<span>OSC.js</span>
<span>are shown in</span>
<span>Example 20-4</span>
<span>, where everything is neatened into</span>
<span>just three lines.</span>
<span>Example 20-4.</span>
<span>The OSC.js file</span>
<span>function O(i) { return typeof i == 'object' ? i : document.getElementById(i) }</span>
<span>function S(i) { return O(i).style }</span>
<span>function C(i) { return document.getElementsByClassName(i) }</span>
<h3>Accessing CSS Properties from JavaScript</h3>
<span>The</span>
<span>textDecoration</span>
<span>property I used in an earlier example represents a CSS property</span>
<span>that is normally hyphenated like this:</span>
<span>text-decoration</span>
<span>. But since JavaScript reserves</span>
<span>the hyphen character for use as a mathematical operator, whenever you access a</span>
<span>hyphenated CSS property, you must omit the hyphen and set the character immedi‐</span>
<span>ately following it to uppercase.</span>
<span>Another example of this is the</span>
<span>font-size</span>
<span>property (for example), which is referenced</span>
<span>in JavaScript as</span>
<span>fontSize</span>
<span>when placed after a period operator, like this:</span>
<span>myobject.fontSize = '16pt'</span>
<span>An alternative to this is to be more long-winded and use the</span>
<span>setAttribute</span>
<span>function,</span>
<span>which does support (and in fact requires) standard CSS property names, like this:</span>
<span>myobject.setAttribute('style', 'font-size:16pt')</span>
<span>Some older versions of Microsoft Internet Explorer are picky in</span>
<span>certain instances about using the JavaScript-style CSS property</span>
<span>names when applying the browser-specific</span>
<span>-ms-</span>
<span>prefixed versions</span>
<span>of the rules. If you encounter this, use the</span>
<span>setAttribute</span>
<span>function</span>
<span>and you should be all right.</span>
<h4>Some Common Properties</h4>
<span>Using JavaScript, you can modify any property of any element in a web document, in</span>
<span>a similar manner to using CSS. I&rsquo;ve already shown you how to access CSS properties</span>
<span>using either the JavaScript short form or the</span>
<span>setAttribute</span>
<span>function to use exact CSS</span>
<span>property names, so I won&rsquo;t bore you by detailing all of these hundreds of properties.</span>
<span>Rather, I&rsquo;d like to show you how to access just a few of the CSS properties as an over‐</span>
<span>view of some of the things you can do.</span>
<span>First,</span>
<span>then,</span>
<span>let&rsquo;s</span>
<span>look</span>
<span>at</span>
<span>modifying</span>
<span>a</span>
<span>few</span>
<span>CSS</span>
<span>properties</span>
<span>from</span>
<span>JavaScript</span>
<span>using</span>
<span>Example 20-5</span>
<span>, which loads in the three earlier functions, creates a</span>
<span>&lt;div&gt;</span>
<span>element, and</span>
<span>then issues JavaScript statements within a</span>
<span>&lt;script&gt;</span>
<span>section of HTML, to modify vari‐</span>
<span>ous of its attributes (see</span>
<span>Figure 20-1</span>
<span>).</span>
<span>Example 20-5. Accessing CSS properties from JavaScript</span>
<span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;head&gt;</span>
<span>&lt;title&gt;Accessing CSS Properties&lt;/title&gt;</span>
<span>&lt;script src='OSC.js'&gt;&lt;/script&gt;</span>
<span>&lt;/head&gt;</span>
<span>&lt;body&gt;</span>
<span>&lt;div id='object'&gt;Div Object&lt;/div&gt;</span>
<span>&lt;script&gt;</span>
<span>&nbsp;</span>
<span>S('object').border = 'solid 1px red'</span>
<span>&nbsp;</span>
<span>S('object').width = '100px'</span>
<span>&nbsp;</span>
<span>S('object').height = '100px'</span>
<span>&nbsp;</span>
<span>S('object').background = '#eee'</span>
<span>&nbsp;</span>
<span>S('object').color = 'blue'</span>
<span>&nbsp;</span>
<span>S('object').fontSize = '15pt'</span>
<span>&nbsp;</span>
<span>S('object').fontFamily = 'Helvetica'</span>
<span>&nbsp;</span>
<span>S('object').fontStyle = 'italic'</span>
<span>&lt;/script&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
<span>Figure 20-1. Modifying styles from JavaScript</span>
<span>You gain nothing by modifying properties like this, because you could just as easily</span>
<span>have</span>
<span>included</span>
<span>some</span>
<span>CSS</span>
<span>directly,</span>
<span>but</span>
<span>shortly</span>
<span>we&rsquo;ll</span>
<span>be</span>
<span>modifying</span>
<span>properties</span>
<span>in</span>
<span>response to user interaction&mdash;and then you&rsquo;ll see the real power of combining Java‐</span>
<span>Script and CSS.</span>
<h4>Other Properties</h4>
<span>JavaScript also opens up access to a very wide range of other properties, such as the</span>
<span>width and height of the browser and of any pop-up or in-browser windows or frames,</span>
<span>handy information such as the parent window (if there is one), and the history of</span>
<span>URLs visited this session.</span>
<span>All these properties are accessed from the</span>
<span>window</span>
<span>object via the period operator (for</span>
<span>example,</span>
<span>window.name</span>
<span>), and</span>
<span>Table 20-1</span>
<span>lists them all, along with descriptions of each.</span>
<span>Table 20-1. Common window properties</span>
<span>Property</span>
<span>Sets and/or returns</span>
<span>closed</span>
<span>Returns a Boolean value indicating whether a window has been closed or not</span>
<span>defaultStatus</span>
<span>Sets or returns the default text in the status bar of a window</span>
<span>document</span>
<span>Returns the</span>
<span>document</span>
<span>object for the window</span>
<span>frames</span>
<span>Returns an array of all the frames and iframes in the window</span>
<span>history</span>
<span>Returns the</span>
<span>history</span>
<span>object for the window</span>
<span>innerHeight</span>
<span>Sets or returns the inner height of a window&rsquo;s content area</span>
<span>innerWidth</span>
<span>Sets or returns the inner width of a window&rsquo;s content area</span>
<span>length</span>
<span>Returns the number of frames and iframes in a window</span>
<span>location</span>
<span>Returns the</span>
<span>location</span>
<span>object for the window</span>
<span>name</span>
<span>Sets or returns the name of a window</span>
<span>Property</span>
<span>Sets and/or returns</span>
<span>navigator</span>
<span>Returns the</span>
<span>navigator</span>
<span>object for the window</span>
<span>opener</span>
<span>Returns a reference to the window that created the window</span>
<span>outerHeight</span>
<span>Sets or returns the outer height of a window, including tool and scroll bars</span>
<span>outerWidth</span>
<span>Sets or returns the outer width of a window, including tool and scroll bars</span>
<span>pageXOffset</span>
<span>Returns the pixels the document has been scrolled horizontally from the left of the window</span>
<span>pageYOffset</span>
<span>Returns the pixels the document has been scrolled vertically from the top of the window</span>
<span>parent</span>
<span>Returns the parent window of a window</span>
<span>screen</span>
<span>Returns the</span>
<span>screen</span>
<span>object for the window</span>
<span>screenLeft</span>
<span>Returns the</span>
<span>x</span>
<span>coordinate of the window relative to the screen in all recent browsers except Mozilla</span>
<span>Firefox (for which you should use</span>
<span>screenX</span>
<span>)</span>
<span>screenTop</span>
<span>Returns the</span>
<span>y</span>
<span>coordinate of the window relative to the screen in all recent browsers except Mozilla</span>
<span>Firefox (for which you should use</span>
<span>screenY</span>
<span>)</span>
<span>screenX</span>
<span>Returns the</span>
<span>x</span>
<span>coordinate of the window relative to the screen in all recent browsers except Opera, which</span>
<span>returns incorrect values; not supported in versions of IE prior to 9</span>
<span>screenY</span>
<span>Returns the</span>
<span>y</span>
<span>coordinate of the window relative to the screen in all recent browsers except Opera, which</span>
<span>returns incorrect values; not supported in versions of IE prior to 9</span>
<span>self</span>
<span>Returns the current window</span>
<span>status</span>
<span>Sets or returns the text in the status bar of a window</span>
<span>top</span>
<span>Returns the top browser window</span>
<span>There are a few points to note about some of these properties:</span>
<span>&bull;</span>
<span>The</span>
<span>defaultStatus</span>
<span>and</span>
<span>status</span>
<span>properties can be set only if users have modified</span>
<span>their browsers to allow it (very unlikely).</span>
<span>&bull;</span>
<span>The</span>
<span>history</span>
<span>object cannot be read from (so you cannot see where your visitors</span>
<span>have been surfing). But it supports the</span>
<span>length</span>
<span>property to determine how long</span>
<span>the history is, and the</span>
<span>back</span>
<span>,</span>
<span>forward</span>
<span>, and</span>
<span>go</span>
<span>methods to navigate to specific</span>
<span>pages in the history.</span>
<span>&bull;</span>
<span>When you need to know how much space there is available in a current window</span>
<span>of</span>
<span>the</span>
<span>web</span>
<span>browser,</span>
<span>just</span>
<span>read</span>
<span>the</span>
<span>values</span>
<span>in</span>
<span>window.innerHeight</span>
<span>and</span>
<span>window.innerWidth</span>
<span>. I often use these values for centering in-browser pop-up</span>
<span>alert or &ldquo;confirm dialog&rdquo; windows.</span>
<span>&bull;</span>
<span>The</span>
<span>screen</span>
<span>object supports the read properties</span>
<span>availHeight</span>
<span>,</span>
<span>availWidth</span>
<span>,</span>
<span>color</span>
<span>Depth</span>
<span>,</span>
<span>height</span>
<span>,</span>
<span>pixelDepth</span>
<span>, and</span>
<span>width</span>
<span>, and is therefore great for determining</span>
<span>information about the user&rsquo;s display.</span>
<span>Many of these properties can be invaluable when you&rsquo;re targeting</span>
<span>mobile phones and tablet devices, as they will tell you exactly how</span>
<span>much screen space you have to work with, the type of browser</span>
<span>being used, and more.</span>
<span>These few items of information will get you started and already provide you with</span>
<span>many new and interesting things you can do with JavaScript. But, in fact, there are far</span>
<span>more properties and methods available than can be covered in this chapter. However,</span>
<span>now that you know how to access and use properties, all you need is a resource listing</span>
<span>them all, so I recommend that you check out tinyurl.com/domproperties as a good</span>
<span>starting point.</span>
<h3>Inline JavaScript</h3>
<span>Using</span>
<span>&lt;script&gt;</span>
<span>tags isn&rsquo;t the only way you can execute JavaScript statements; you</span>
<span>can also access JavaScript from within HTML tags, which makes for great dynamic</span>
<span>interactivity. For example, to add a quick effect when the mouse passes over an object,</span>
<span>you can use code such as that in the</span>
<span>&lt;img&gt;</span>
<span>tag in</span>
<span>Example 20-6</span>
<span>, which displays an</span>
<span>apple by default, but replaces it with an orange when the mouse passes over, and</span>
<span>restores the apple again when the mouse leaves.</span>
<span>Example 20-6. Using inline JavaScript</span>
<span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;head&gt;</span>
<span>&lt;title&gt;Inline JavaScript&lt;/title&gt;</span>
<span>&lt;/head&gt;</span>
<span>&lt;body&gt;</span>
<span>&lt;img src='apple.png'</span>
<span>&nbsp;</span>
<span>onmouseover="this.src='orange.png'"</span>
<span>&nbsp;</span>
<span>onmouseout="this.src='apple.png'"&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
<h4>The this Keyword</h4>
<span>In the preceding example, you see the</span>
<span>this</span>
<span>keyword in use. It tells the JavaScript to</span>
<span>operate on the calling object, namely the</span>
<span>&lt;img&gt;</span>
<span>tag. You can see the result in</span>
<span>Figure 20-2</span>
<span>, where the mouse has yet to pass over the apple.</span>
<span>Figure 20-2. Inline mouse hover JavaScript example</span>
<span>When supplied from an inline JavaScript call, the</span>
<span>this</span>
<span>keyword</span>
<span>represents the calling object. When used in class methods, it repre‐</span>
<span>sents an object to which the method applies.</span>
<h4>Attaching Events to Objects in a Script</h4>
<span>The preceding code is the equivalent of providing an ID to the</span>
<span>&lt;img&gt;</span>
<span>tag, and then</span>
<span>attaching the actions to the tag&rsquo;s mouse events, like</span>
<span>Example 20-7</span>
<span>.</span>
<span>Example 20-7. Non-inline JavaScript</span>
<span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;head&gt;</span>
<span>&lt;title&gt;Non-inline JavaScript&lt;/title&gt;</span>
<span>&lt;script src='OSC.js'&gt;&lt;/script&gt;</span>
<span>&lt;/head&gt;</span>
<span>&lt;body&gt;</span>
<span>&lt;img id='object' src='apple.png'&gt;</span>
<span>&lt;script&gt;</span>
<span>&nbsp;</span>
<span>O('object').onmouseover = function() { this.src = 'orange.png' }</span>
<span>&nbsp;</span>
<span>O('object').onmouseout = function() { this.src = 'apple.png' }</span>
<span>&lt;/script&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
<span>In the HTML section, this example gives the</span>
<span>&lt;img&gt;</span>
<span>element an ID of</span>
<span>object</span>
<span>, and</span>
<span>then proceeds to manipulate it separately in the JavaScript section by attaching</span>
<span>anonymous functions to each event.</span>
<h4>Attaching to Other Events</h4>
<span>Whether you&rsquo;re using inline or separate JavaScript, there are several events to which</span>
<span>you can attach actions, providing a wealth of additional features you can offer your</span>
<span>users.</span>
<span>Table 20-2</span>
<span>lists these events and details when they will be triggered.</span>
<span>Table 20-2. Events and when they are triggered</span>
<span>Event</span>
<span>Occurs</span>
<span>onabort</span>
<span>When an image&rsquo;s loading is stopped before completion</span>
<span>onblur</span>
<span>When an element loses focus</span>
<span>onchange</span>
<span>When any part of a form has changed</span>
<span>onclick</span>
<span>When an object is clicked</span>
<span>ondblclick</span>
<span>When an object is double-clicked</span>
<span>onerror</span>
<span>When a JavaScript error is encountered</span>
<span>onfocus</span>
<span>When an element gets focus</span>
<span>onkeydown</span>
<span>When a key is being pressed (including Shift, Alt, Ctrl, and Esc)</span>
<span>onkeypress</span>
<span>When a key is being pressed (not including Shift, Alt, Ctrl, and Esc)</span>
<span>onkeyup</span>
<span>When a key is released</span>
<span>onload</span>
<span>When an object has loaded</span>
<span>onmousedown</span>
<span>When the mouse button is pressed over an element</span>
<span>onmousemove</span>
<span>When the mouse is moved over an element</span>
<span>onmouseout</span>
<span>When the mouse leaves an element</span>
<span>onmouseover</span>
<span>When the mouse passes over an element from outside it</span>
<span>onmouseup</span>
<span>When the mouse button is released</span>
<span>onsubmit</span>
<span>When a form is submitted</span>
<span>onreset</span>
<span>When a form is reset</span>
<span>onresize</span>
<span>When the browser is resized</span>
<span>onscroll</span>
<span>When the document is scrolled</span>
<span>onselect</span>
<span>When some text is selected</span>
<span>onunload</span>
<span>When a document is removed</span>
<span>Make sure you attach events to objects that make sense. For exam‐</span>
<span>ple, an object that is not a form will not respond to the</span>
<span>onsubmit</span>
<span>event.</span>
<h3>Adding New Elements</h3>
<span>With JavaScript, you are not limited to manipulating the elements and objects sup‐</span>
<span>plied to a document in its HTML. In fact, you can create objects at will by inserting</span>
<span>them into the DOM.</span>
<span>For example, suppose you need a new</span>
<span>&lt;div&gt;</span>
<span>element.</span>
<span>Example 20-8</span>
<span>shows one way</span>
<span>you can add it to the web page.</span>
<span>Example 20-8. Inserting an element into the DOM</span>
<span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;head&gt;</span>
<span>&lt;title&gt;Adding Elements&lt;/title&gt;</span>
<span>&lt;script src='OSC.js'&gt;&lt;/script&gt;</span>
<span>&lt;/head&gt;</span>
<span>&lt;body&gt;</span>
<span>This is a document with only this text in it.&lt;br&gt;&lt;br&gt;</span>
<span>&lt;script&gt;</span>
<span>&nbsp;</span>
<span>alert('Click OK to add an element')</span>
<span>&nbsp;</span>
<span>newdiv = document.createElement('div')</span>
<span>&nbsp;</span>
<span>newdiv.id = 'NewDiv'</span>
<span>&nbsp;</span>
<span>document.body.appendChild(newdiv)</span>
<span>&nbsp;</span>
<span>S(newdiv).border = 'solid 1px red'</span>
<span>&nbsp;</span>
<span>S(newdiv).width = '100px'</span>
<span>&nbsp;</span>
<span>S(newdiv).height = '100px'</span>
<span>&nbsp;</span>
<span>newdiv.innerHTML = "I'm a new object inserted in the DOM"</span>
<span>&nbsp;</span>
<span>tmp = newdiv.offsetTop</span>
<span>&nbsp;</span>
<span>alert('Click OK to remove the element')</span>
<span>&nbsp;</span>
<span>pnode = newdiv.parentNode</span>
<span>&nbsp;</span>
<span>pnode.removeChild(newdiv)</span>
<span>&nbsp;</span>
<span>tmp = pnode.offsetTop</span>
<span>&lt;/script&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
<span>Figure 20-3</span>
<span>shows this code being used to add a new</span>
<span>&lt;div&gt;</span>
<span>element to a web docu‐</span>
<span>ment. First, the new element is created with</span>
<span>createElement</span>
<span>; then the</span>
<span>appendChild</span>
<span>function is called, and the element gets inserted into the DOM.</span>
<span>Figure 20-3. Inserting a new element into the DOM</span>
<span>After this, various properties are assigned to the element, including some text for its</span>
<span>inner HTML. And then, in order to make sure the new element is instantly revealed,</span>
<span>its</span>
<span>offsetTop</span>
<span>property is read into the throwaway variable</span>
<span>tmp</span>
<span>. This forces a DOM</span>
<span>refresh and makes the element display in any browser that might otherwise delay</span>
<span>before doing so&mdash;particularly Internet Explorer.</span>
<span>This new element is exactly the same as if it had been included in the original HTML,</span>
<span>and has all the same properties and methods available.</span>
<span>I sometimes use the technique of creating new elements when I</span>
<span>want to create in-browser pop-up windows, because it doesn&rsquo;t rely</span>
<span>on there having to be a spare</span>
<span>&lt;div&gt;</span>
<span>element available in the DOM.</span>
<h4>Removing Elements</h4>
<span>You can also remove elements from the DOM, including ones that you didn&rsquo;t insert</span>
<span>using JavaScript; it&rsquo;s even easier than adding an element. It works like this, assuming</span>
<span>the element to remove is in the object</span>
<span>element</span>
<span>:</span>
<span>element.parentNode.removeChild(element)</span>
<span>This code accesses the element&rsquo;s</span>
<span>parentNode</span>
<span>object so that it can remove the element</span>
<span>from that node. Then it calls the</span>
<span>removeChild</span>
<span>method on that object, passing the</span>
<span>object to be removed. However, to ensure the DOM instantly refreshes on all brows‐</span>
<span>ers, you may prefer to replace the preceding single statement with something like this:</span>
<span>pnode = element.parentNode</span>
<span>pnode.removeChild(element)</span>
<span>tmp = pnode.offsetTop</span>
<span>This first statement makes a copy of</span>
<span>element.parentNode</span>
<span>(the parent element of the</span>
<span>object) in</span>
<span>pnode</span>
<span>, which (after the child element is removed) has its</span>
<span>offsetTop</span>
<span>prop‐</span>
<span>erty looked up (and discarded in the throwaway variable</span>
<span>tmp</span>
<span>), thus ensuring that the</span>
<span>DOM is fully refreshed.</span>
<h4>Alternatives to Adding and Removing Elements</h4>
<span>Inserting an element is intended for adding totally new objects into a web page. But if</span>
<span>all you intend to do is hide and reveal objects according to an</span>
<span>onmouseover</span>
<span>or other</span>
<span>event, don&rsquo;t forget that there are always a couple of CSS properties you can use for</span>
<span>this purpose, without taking such drastic measures as creating and deleting DOM ele‐</span>
<span>ments.</span>
<span>For example, when you want to make an element invisible but leave it in place (and</span>
<span>with all the elements surrounding it remaining in their positions), you can simply set</span>
<span>the object&rsquo;s</span>
<span>visibility</span>
<span>property to</span>
<span>'hidden'</span>
<span>, like this:</span>
<span>myobject.visibility = 'hidden'</span>
<span>And to redisplay the object, you can use the following:</span>
<span>myobject.visibility = 'visible'</span>
<span>You can also collapse elements down to occupy zero width and height (with all</span>
<span>objects around it filling in the freed-up space), like this:</span>
<span>myobject.display = 'none'</span>
<span>To then restore an element to its original dimensions, you would use the following:</span>
<span>myobject.display = 'block'</span>
<span>And, of course, there&rsquo;s always the</span>
<span>innerHTML</span>
<span>property, with which you can change the</span>
<span>HTML applied to an element, like this, for example:</span>
<span>mylement.innerHTML = '&lt;b&gt;Replacement HTML&lt;/b&gt;'</span>
<span>Or you can use the</span>
<span>O</span>
<span>function I outlined earlier, like this:</span>
<span>O('someid').innerHTML = 'New contents'</span>
<span>Or you can make an element seem to disappear, like this:</span>
<span>O('someid').innerHTML = ''</span>
<span>Don&rsquo;t forget other useful CSS properties you can access from Java‐</span>
<span>Script, such as</span>
<span>opacity</span>
<span>for setting the visibility of an object to</span>
<span>somewhere between visible and invisible, or</span>
<span>width</span>
<span>and</span>
<span>height</span>
<span>for</span>
<span>resizing an object. And, of course, using the</span>
<span>position</span>
<span>property</span>
<span>with values of</span>
<span>'absolute'</span>
<span>,</span>
<span>'static'</span>
<span>, or</span>
<span>'relative'</span>
<span>, you can even</span>
<span>locate an object anywhere in (or outside) the browser window that</span>
<span>you like.</span>
<h3>Using Interrupts</h3>
<span>JavaScript provides access to</span>
<span>interrupts</span>
<span>, a method by which you can ask the browser</span>
<span>to call your code after a set period of time, or even to keep calling it at specified inter‐</span>
<span>vals. This gives you a means of handling background tasks such as Ajax communica‐</span>
<span>tions, or even things like animating web elements.</span>
<span>To accomplish this, you have two types of interrupt:</span>
<span>setTimeout</span>
<span>and</span>
<span>setInterval</span>
<span>,</span>
<span>which have accompanying</span>
<span>clearTimeout</span>
<span>and</span>
<span>clearInterval</span>
<span>functions for turning</span>
<span>them off again.</span>
<h4>Using setTimeout</h4>
<span>When you call</span>
<span>setTimeout</span>
<span>, you pass it some JavaScript code or the name of a func‐</span>
<span>tion, and the value in milliseconds representing how long to wait before the code</span>
<span>should be executed, like this:</span>
<span>setTimeout(dothis, 5000)</span>
<span>And your</span>
<span>dothis</span>
<span>function might look like this:</span>
<span>function dothis()</span>
<span>{</span>
<span>alert('This is your wakeup alert!');</span>
<span>}</span>
<span>In case you&rsquo;re wondering, you cannot simply specify</span>
<span>alert()</span>
<span>(with</span>
<span>brackets) as a function to be called by</span>
<span>setTimeout</span>
<span>, because the</span>
<span>function would be executed immediately. Only when you provide a</span>
<span>function name without argument brackets (for example,</span>
<span>alert</span>
<span>)</span>
<span>can you safely pass the function name so that its code will be exe‐</span>
<span>cuted only when the time-out occurs.</span>
<span>Passing a string</span>
<span>When you need to provide an argument to a function, you can also pass a string value</span>
<span>to the</span>
<span>setTimeout</span>
<span>function, which will not be executed until the correct time, like</span>
<span>this:</span>
<span>setTimeout("alert('Hello!')", 5000)</span>
<span>In fact, you can provide as many lines of JavaScript code as you like, if you place a</span>
<span>semicolon after each statement, like this:</span>
<span>setTimeout("document.write('Starting'); alert('Hello!')", 5000)</span>
<span>Repeating time-outs</span>
<span>One technique some programmers use to provide repeating interrupts using the</span>
<span>function</span>
<span>setTimeout</span>
<span>is to call the</span>
<span>setTimeout</span>
<span>function from the code called by it, as</span>
<span>with the following, which will initiate a never-ending loop of alert windows:</span>
<span>setTimeout(dothis, 5000)</span>
<span>function dothis()</span>
<span>{</span>
<span>setTimeout(dothis, 5000)</span>
<span>alert('I am annoying!')</span>
<span>}</span>
<span>Now the alert will pop up every five seconds.</span>
<h4>Cancelling a Time-Out</h4>
<span>Once a time-out has been set up, you can cancel it if you previously saved the value</span>
<span>returned from the initial call to</span>
<span>setTimeout</span>
<span>, like this:</span>
<span>handle = setTimeout(dothis, 5000)</span>
<span>Armed with the value in</span>
<span>handle</span>
<span>, you can now cancel the interrupt at any point up</span>
<span>until its due time, like this:</span>
<span>clearTimeout(handle)</span>
<span>When you do this, the interrupt is completely forgotten, and the code assigned to it</span>
<span>will not get executed.</span>
<h4>Using setInterval</h4>
<span>An easier way to set up regular interrupts is to use the</span>
<span>setInterval</span>
<span>function. It works</span>
<span>in just the same way, except that having popped up after the interval you specify in</span>
<span>milliseconds, it will do so again after that interval again passes, and so on forever,</span>
<span>unless you cancel it.</span>
<span>Example 20-9</span>
<span>uses this function to display a simple clock in the browser, as shown in</span>
<span>Figure 20-4</span>
<span>.</span>
<span>Example 20-9. A clock created using interrupts</span>
<span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;head&gt;</span>
<span>&lt;title&gt;Using setInterval&lt;/title&gt;</span>
<span>&lt;script src='OSC.js'&gt;&lt;/script&gt;</span>
<span>&lt;/head&gt;</span>
<span>&lt;body&gt;</span>
<span>The time is: &lt;span id='time'&gt;00:00:00&lt;/span&gt;&lt;br&gt;</span>
<span>&lt;script&gt;</span>
<span>&nbsp;</span>
<span>setInterval("showtime(O('time'))", 1000)</span>
<span>&nbsp;</span>
<span>function showtime(object)</span>
<span>&nbsp;</span>
<span>{</span>
<span>&nbsp;</span>
<span>var date = new Date()</span>
<span>&nbsp;</span>
<span>object.innerHTML = date.toTimeString().substr(0,8)</span>
<span>&nbsp;</span>
<span>}</span>
<span>&lt;/script&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
<span>Figure 20-4. Maintaining the correct time with interrupts</span>
<span>Every time</span>
<span>ShowTime</span>
<span>is called, it sets the object</span>
<span>date</span>
<span>to the current date and time with</span>
<span>a call to</span>
<span>Date</span>
<span>:</span>
<span>var date = new Date()</span>
<span>Then the</span>
<span>innerHTML</span>
<span>property of the object passed to</span>
<span>showtime</span>
<span>(namely,</span>
<span>object</span>
<span>) is set</span>
<span>to the current time in hours, minutes, and seconds, as determined by a call to the</span>
<span>function</span>
<span>toTimeString</span>
<span>. This returns a string such as</span>
<span>09:57:17 UTC+0530</span>
<span>, which is</span>
<span>then truncated to just the first eight characters with a call to the</span>
<span>substr</span>
<span>function:</span>
<span>object.innerHTML = date.toTimeString().substr(0,8)</span>
<span>Using the function</span>
<span>To use this function, you first have to create an object whose</span>
<span>innerHTML</span>
<span>property will</span>
<span>be used for displaying the time, like this HTML:</span>
<span>The time is: &lt;span id='time'&gt;00:00:00&lt;/span&gt;</span>
<span>Then, from a</span>
<span>&lt;script&gt;</span>
<span>section of code, a call is placed to the</span>
<span>setInterval</span>
<span>function,</span>
<span>like this:</span>
<span>setInterval("showtime(O('time'))", 1000)</span>
<span>It then passes a string to</span>
<span>setInterval</span>
<span>, containing the following statement, which is</span>
<span>set to execute once a second (every 1,000 milliseconds):</span>
<span>showtime(O('time'))</span>
<span>In the rare situation where somebody has disabled JavaScript (which people some‐</span>
<span>times do for security reasons), your JavaScript will not run and the user will see the</span>
<span>original</span>
<span>00:00:00</span>
<span>.</span>
<span>Cancelling an interval</span>
<span>To stop a repeating interval, when you first set up the interval with a call to the func‐</span>
<span>tion</span>
<span>setInterval</span>
<span>, you must make a note of the interval&rsquo;s handle, like this:</span>
<span>handle = setInterval("showtime(O('time'))", 1000)</span>
<span>Now you can stop the clock at any time by issuing the following call:</span>
<span>clearInterval(handle)</span>
<span>You can even set up a timer to stop the clock after a certain amount of time, like this:</span>
<span>setTimeout("clearInterval(handle)", 10000)</span>
<span>This statement will issue an interrupt in 10 seconds that will clear the repeating inter‐</span>
<span>vals.</span>
<h4>Using Interrupts for Animation</h4>
<span>By combining a few CSS properties with a repeating interrupt, you can produce all</span>
<span>manner of animations and effects.</span>
<span>For example, the code in</span>
<span>&nbsp;Example 20-10</span>
<span>&nbsp;moves a square shape across the top of a</span>
<span>browser, all the time ballooning in size, as shown in</span>
<span>Figure 20-5</span>
<span>, before starting all</span>
<span>over again when</span>
<span>LEFT</span>
<span>is reset to</span>
<span>0</span>
<span>.</span>
<span>Example 20-10. A simple animation</span>
<span>&lt;!DOCTYPE html&gt;</span>
<span>&lt;html&gt;</span>
<span>&lt;head&gt;</span>
<span>&lt;title&gt;Simple Animation&lt;/title&gt;</span>
<span>&lt;script src='OSC.js'&gt;&lt;/script&gt;</span>
<span>&lt;style&gt;</span>
<span>&nbsp;</span>
<span>#box {</span>
<span>&nbsp;</span>
<span>position :absolute;</span>
<span>&nbsp;</span>
<span>background:orange;</span>
<span>&nbsp;</span>
<span>border :1px solid red;</span>
<span>&nbsp;</span>
<span>}</span>
<span>&lt;/style&gt;</span>
<span>&lt;/head&gt;</span>
<span>&lt;body&gt;</span>
<span>&lt;div id='box'&gt;&lt;/div&gt;</span>
<span>&lt;script&gt;</span>
<span>&nbsp;</span>
<span>SIZE = LEFT = 0</span>
<span>&nbsp;</span>
<span>setInterval(animate, 30)</span>
<span>&nbsp;</span>
<span>function animate()</span>
<span>&nbsp;</span>
<span>{</span>
<span>&nbsp;</span>
<span>SIZE += 10</span>
<span>&nbsp;</span>
<span>LEFT += 3</span>
<span>&nbsp;</span>
<span>if (SIZE == 200) SIZE = 0</span>
<span>&nbsp;</span>
<span>if (LEFT == 600) LEFT = 0</span>
<span>&nbsp;</span>
<span>S('box').width = SIZE + 'px'</span>
<span>&nbsp;</span>
<span>S('box').height = SIZE + 'px'</span>
<span>&nbsp;</span>
<span>S('box').left = LEFT + 'px'</span>
<span>&nbsp;</span>
<span>}</span>
<span>&lt;/script&gt;</span>
<span>&lt;/body&gt;</span>
<span>&lt;/html&gt;</span>
<span>Figure 20-5. This object slides in from the left while changing size</span>
<span>In the</span>
<span>&lt;head&gt;</span>
<span>section of the document, the</span>
<span>box</span>
<span>object is set to a</span>
<span>background</span>
<span>color of</span>
<span>'orange'</span>
<span>with a</span>
<span>border</span>
<span>value of</span>
<span>'1px solid red'</span>
<span>, and its</span>
<span>position</span>
<span>property is set</span>
<span>to</span>
<span>absolute</span>
<span>so that it is allowed to be moved around in the browser.</span>
<span>Then, in the</span>
<span>animate</span>
<span>function, the global variables</span>
<span>SIZE</span>
<span>and</span>
<span>LEFT</span>
<span>are continuously</span>
<span>updated and then applied to the</span>
<span>width</span>
<span>,</span>
<span>height</span>
<span>, and</span>
<span>left</span>
<span>style attributes of the</span>
<span>box</span>
<span>object (with</span>
<span>'px'</span>
<span>added after each to specify that the values are in pixels), thus ani‐</span>
<span>mating it at a frequency of once every 30 milliseconds&mdash;giving a rate of 33.33 frames</span>
<span>per second (1,000/30 milliseconds).</span>
<h3>Questions</h3>
<span>1.</span>
<span>What are the</span>
<span>O</span>
<span>,</span>
<span>S</span>
<span>, and</span>
<span>C</span>
<span>functions provided to do?</span>
<span>2.</span>
<span>Name two ways to modify a CSS attribute of an object.</span>
<span>3.</span>
<span>Which properties provide the width and height available in a browser window?</span>
<span>4.</span>
<span>How can you make something happen when the mouse passes both over and out</span>
<span>of an object?</span>
<span>5.</span>
<span>Which JavaScript function creates new elements, and which appends them to the</span>
<span>DOM?</span>
<span>6.</span>
<span>How can you make an element (a) invisible, and (b) collapse to zero dimensions?</span>
<span>7.</span>
<span>Which function creates a single event at a future time?</span>
<span>8.</span>
<span>Which function sets up repeating events at set intervals?</span>
<span>9.</span>
<span>How can you release an element from its location in a web page to enable it to be</span>
<span>moved around?</span>
<span>10.</span>
<span>What delay between events should you set (in milliseconds) to achieve an anima‐</span>
<span>tion rate of 50 frames per second?</span>
<span>See</span>
<span>Chapter 20 Answers</span>
<span>in</span>
<span>Appendix A</span>
<span>for the answers to these questions.</span>