---
layout: default
---

  <h1 class="title">Introduction</h1>
  <p class="para">
   This extension provides asyncronous POSIX I/O by means of <a href="http://software.schmorp.de/pkg/libeio.html" class="link external">&#xBB;&#xA0;libeio</a> C
   library written by Marc Lehmann.
  </p>

  <blockquote class="note"><p><strong class="note">Note</strong>: <span class="simpara">This extension is not
available on Windows platforms.</span></p></blockquote>

  <p class="para">

  <div class="warning"><strong class="warning">Warning</strong>
  <p class="simpara">
  It is important to aware that each request is executed in a thread, and the
  order of execution of continuously queued requests basically is
  unpredictable. For instance, the following piece of code is incorrect.
  </p>
  </div>

  <div class="example" id="example-4124">
  <p><strong>Example #1 Incorrect requests</strong></p>
  <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&#xA0;Request&#xA0;to&#xA0;create&#xA0;symlink&#xA0;of&#xA0;$filename&#xA0;to&#xA0;$link<br></span><span style="color: #0000BB">eio_symlink</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$link</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Request&#xA0;to&#xA0;move&#xA0;$filename&#xA0;to&#xA0;$new_filename<br></span><span style="color: #0000BB">eio_rename</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$new_filename</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Process&#xA0;requests<br></span><span style="color: #0000BB">eio_event_loop</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   </div>

   In the example above <span class="function"><a href="function.eio-rename.html" class="function">eio_rename()</a></span> request may finish
   before <span class="function"><a href="function.eio-symlink.html" class="function">eio_symlink()</a></span>. To fix it you might call <span class="function"><a href="function.eio-rename.html" class="function">eio_rename()</a></span>
   in the callback of <span class="function"><a href="function.eio-symlink.html" class="function">eio_symlink()</a></span>:
  <div class="example" id="example-4125">
   <p><strong>Example #2 Calling request from a request callback</strong></p>
   <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">function&#xA0;</span><span style="color: #0000BB">my_symlink_done</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&#xA0;{<br>&#xA0;</span><span style="color: #FF8000">//&#xA0;Request&#xA0;to&#xA0;move&#xA0;$filename&#xA0;to&#xA0;$new_filename<br>&#xA0;</span><span style="color: #0000BB">eio_rename</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;/path/to/new-name&quot;</span><span style="color: #007700">);<br><br>&#xA0;</span><span style="color: #FF8000">//&#xA0;Process&#xA0;requests<br>&#xA0;</span><span style="color: #0000BB">eio_event_loop</span><span style="color: #007700">();<br>}<br><br></span><span style="color: #FF8000">//&#xA0;Request&#xA0;to&#xA0;create&#xA0;symlink&#xA0;of&#xA0;$filename&#xA0;to&#xA0;$link<br></span><span style="color: #0000BB">eio_symlink</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$link</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">EIO_PRI_DEFAULT</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;my_symlink_done&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Process&#xA0;requests<br></span><span style="color: #0000BB">eio_event_loop</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  Alternatively, you might want to create a request group:

  <div class="example" id="example-4126">
   <p><strong>Example #3 Calling request from a request callback</strong></p>
   <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/*&#xA0;Is&#xA0;called&#xA0;when&#xA0;the&#xA0;group&#xA0;requests&#xA0;are&#xA0;done&#xA0;*/<br></span><span style="color: #007700">function&#xA0;</span><span style="color: #0000BB">my_grp_done</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&#xA0;{<br>&#xA0;</span><span style="color: #FF8000">//&#xA0;...<br></span><span style="color: #007700">}<br><br>function&#xA0;</span><span style="color: #0000BB">my_symlink_done</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">)&#xA0;{<br>&#xA0;</span><span style="color: #FF8000">//&#xA0;Create&#xA0;eio_rename&#xA0;request&#xA0;and&#xA0;add&#xA0;it&#xA0;to&#xA0;the&#xA0;group<br>&#xA0;</span><span style="color: #0000BB">$req&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">eio_rename</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;/path/to/new-name&quot;</span><span style="color: #007700">);<br>&#xA0;</span><span style="color: #0000BB">eio_grp_add</span><span style="color: #007700">(</span><span style="color: #0000BB">$grp</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$req</span><span style="color: #007700">);<br>&#xA0;</span><span style="color: #FF8000">//&#xA0;You&#xA0;might&#xA0;want&#xA0;to&#xA0;add&#xA0;more&#xA0;requests...<br></span><span style="color: #007700">}<br><br></span><span style="color: #FF8000">//&#xA0;Create&#xA0;a&#xA0;request&#xA0;group<br></span><span style="color: #0000BB">$grp&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">eio_grp</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;my_grp_done&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;my_grp_data&quot;</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Create&#xA0;eio_symlink&#xA0;request&#xA0;and&#xA0;add&#xA0;it&#xA0;to&#xA0;the&#xA0;group<br>//&#xA0;Pass&#xA0;$filename&#xA0;to&#xA0;the&#xA0;callback<br></span><span style="color: #0000BB">$req&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">eio_symlink</span><span style="color: #007700">(</span><span style="color: #0000BB">$filename</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$link</span><span style="color: #007700">,<br>&#xA0;&#xA0;</span><span style="color: #0000BB">EIO_PRI_DEFAULT</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;my_symlink_done&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$filename</span><span style="color: #007700">);<br></span><span style="color: #0000BB">eio_grp_add</span><span style="color: #007700">(</span><span style="color: #0000BB">$grp</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$req</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Process&#xA0;requests<br></span><span style="color: #0000BB">eio_event_loop</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div></div>

  </div>

  Group is a special kind of request that could accumulate a set of regular
  <em class="emphasis">eio</em> requests. This could be used to create a complex
  request that opens, reads and closes a file.
  </p>
  <p class="para">
  Since version 0.3.0 alpha, a variable used in communications with libeio
  internally, could be retrieved with
  <span class="function"><a href="function.eio-get-event-stream.html" class="function">eio_get_event_stream()</a></span>. The variable could be used
  to bind to an event loop supported by some other extension. You might
  organize a simple event loop where eio and libevent work together:
  <div class="example" id="example-4127">
   <p><strong>Example #4 Using eio with libevent</strong></p>
   <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #007700">function&#xA0;</span><span style="color: #0000BB">my_eio_poll</span><span style="color: #007700">(</span><span style="color: #0000BB">$fd</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$events</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$arg</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;Some&#xA0;libevent&#xA0;regulation&#xA0;might&#xA0;go&#xA0;here&#xA0;..&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">if&#xA0;(</span><span style="color: #0000BB">eio_nreqs</span><span style="color: #007700">())&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">eio_poll</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;..&#xA0;and&#xA0;here&#xA0;*/<br></span><span style="color: #007700">}<br><br>function&#xA0;</span><span style="color: #0000BB">my_res_cb</span><span style="color: #007700">(</span><span style="color: #0000BB">$d</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$r</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$r</span><span style="color: #007700">);&#xA0;</span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$d</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$base&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">event_base_new</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$event&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">event_new</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">//&#xA0;This&#xA0;stream&#xA0;is&#xA0;used&#xA0;to&#xA0;bind&#xA0;with&#xA0;libevent<br></span><span style="color: #0000BB">$fd&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">eio_get_event_stream</span><span style="color: #007700">();<br><br></span><span style="color: #0000BB">eio_nop</span><span style="color: #007700">(</span><span style="color: #0000BB">EIO_PRI_DEFAULT</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;my_res_cb&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;nop&#xA0;data&quot;</span><span style="color: #007700">);<br></span><span style="color: #0000BB">eio_mkdir</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;/tmp/abc-eio-temp&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">0750</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">EIO_PRI_DEFAULT</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;my_res_cb&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;mkdir&#xA0;data&quot;</span><span style="color: #007700">);<br></span><span style="color: #FF8000">/*&#xA0;some&#xA0;other&#xA0;eio_*&#xA0;calls&#xA0;here&#xA0;...&#xA0;*/<br><br><br>//&#xA0;set&#xA0;event&#xA0;flags<br></span><span style="color: #0000BB">event_set</span><span style="color: #007700">(</span><span style="color: #0000BB">$event</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$fd</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">EV_READ&#xA0;</span><span style="color: #FF8000">/*|&#xA0;EV_PERSIST*/</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;my_eio_poll&quot;</span><span style="color: #007700">,&#xA0;array(</span><span style="color: #0000BB">$event</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$base</span><span style="color: #007700">));<br><br></span><span style="color: #FF8000">//&#xA0;set&#xA0;event&#xA0;base&#xA0;<br></span><span style="color: #0000BB">event_base_set</span><span style="color: #007700">(</span><span style="color: #0000BB">$event</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$base</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;enable&#xA0;event<br></span><span style="color: #0000BB">event_add</span><span style="color: #007700">(</span><span style="color: #0000BB">$event</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;start&#xA0;event&#xA0;loop<br></span><span style="color: #0000BB">event_base_loop</span><span style="color: #007700">(</span><span style="color: #0000BB">$base</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*&#xA0;The&#xA0;same&#xA0;will&#xA0;be&#xA0;available&#xA0;via&#xA0;buffered&#xA0;libevent&#xA0;interface&#xA0;*/<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div></div>

  </div>

  </p>
 