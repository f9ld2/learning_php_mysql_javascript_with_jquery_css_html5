---
layout: default
---

  <h2 class="title">Basic Gearman client and worker, background</h2>
  <p class="para">
   <div class="example" id="example-4895">
    <p><strong>Example #1 Basic Gearman client and worker, background</strong></p>
    <div class="example-contents"><p>
     This example shows a very simple client and worker.  The client sends a string
     to the job server as a background job, and the worker reverses the string.
     Note that since the work is performed asynchronously, the client does not
     wait for the job to complete and exits (and hence the client never receives the results).
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">#&#xA0;create&#xA0;our&#xA0;client&#xA0;object<br></span><span style="color: #0000BB">$gmclient</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">GearmanClient</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;add&#xA0;the&#xA0;default&#xA0;server&#xA0;(localhost)<br></span><span style="color: #0000BB">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServer</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;run&#xA0;reverse&#xA0;client&#xA0;in&#xA0;the&#xA0;background<br></span><span style="color: #0000BB">$job_handle&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">doBackground</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;reverse&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;this&#xA0;is&#xA0;a&#xA0;test&quot;</span><span style="color: #007700">);<br><br>if&#xA0;(</span><span style="color: #0000BB">$gmclient</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">returnCode</span><span style="color: #007700">()&#xA0;!=&#xA0;</span><span style="color: #0000BB">GEARMAN_SUCCESS</span><span style="color: #007700">)<br>{<br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;bad&#xA0;return&#xA0;code\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;exit;<br>}<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;done!\n&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">echo&#xA0;</span><span style="color: #DD0000">&quot;Starting\n&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">#&#xA0;Create&#xA0;our&#xA0;worker&#xA0;object.<br></span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">GearmanWorker</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;Add&#xA0;default&#xA0;server&#xA0;(localhost).<br></span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServer</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;Register&#xA0;function&#xA0;&quot;reverse&quot;&#xA0;with&#xA0;the&#xA0;server.&#xA0;Change&#xA0;the&#xA0;worker&#xA0;function&#xA0;to<br>#&#xA0;&quot;reverse_fn_fast&quot;&#xA0;for&#xA0;a&#xA0;faster&#xA0;worker&#xA0;with&#xA0;no&#xA0;output.<br></span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addFunction</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;reverse&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;reverse_fn&quot;</span><span style="color: #007700">);<br><br>print&#xA0;</span><span style="color: #DD0000">&quot;Waiting&#xA0;for&#xA0;job...\n&quot;</span><span style="color: #007700">;<br>while(</span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">work</span><span style="color: #007700">())<br>{<br>&#xA0;&#xA0;if&#xA0;(</span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">returnCode</span><span style="color: #007700">()&#xA0;!=&#xA0;</span><span style="color: #0000BB">GEARMAN_SUCCESS</span><span style="color: #007700">)<br>&#xA0;&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;return_code:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">returnCode</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;break;<br>&#xA0;&#xA0;}<br>}<br><br>function&#xA0;</span><span style="color: #0000BB">reverse_fn</span><span style="color: #007700">(</span><span style="color: #0000BB">$job</span><span style="color: #007700">)<br>{<br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Received&#xA0;job:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">handle</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;</span><span style="color: #0000BB">$workload&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">workload</span><span style="color: #007700">();<br>&#xA0;&#xA0;</span><span style="color: #0000BB">$workload_size&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">workloadSize</span><span style="color: #007700">();<br><br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Workload:&#xA0;</span><span style="color: #0000BB">$workload</span><span style="color: #DD0000">&#xA0;(</span><span style="color: #0000BB">$workload_size</span><span style="color: #DD0000">)\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;</span><span style="color: #FF8000">#&#xA0;This&#xA0;status&#xA0;loop&#xA0;is&#xA0;not&#xA0;needed,&#xA0;just&#xA0;showing&#xA0;how&#xA0;it&#xA0;works<br>&#xA0;&#xA0;</span><span style="color: #007700">for&#xA0;(</span><span style="color: #0000BB">$x</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&#xA0;</span><span style="color: #0000BB">$x&#xA0;</span><span style="color: #007700">&lt;&#xA0;</span><span style="color: #0000BB">$workload_size</span><span style="color: #007700">;&#xA0;</span><span style="color: #0000BB">$x</span><span style="color: #007700">++)<br>&#xA0;&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Sending&#xA0;status:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;(</span><span style="color: #0000BB">$x&#xA0;</span><span style="color: #007700">+&#xA0;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;/</span><span style="color: #0000BB">$workload_size</span><span style="color: #DD0000">&#xA0;complete\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sendStatus</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$workload_size</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">sleep</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br>&#xA0;&#xA0;}<br><br>&#xA0;&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">strrev</span><span style="color: #007700">(</span><span style="color: #0000BB">$workload</span><span style="color: #007700">);<br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Result:&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #DD0000">\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;</span><span style="color: #FF8000">#&#xA0;Return&#xA0;what&#xA0;we&#xA0;want&#xA0;to&#xA0;send&#xA0;back&#xA0;to&#xA0;the&#xA0;client.<br>&#xA0;&#xA0;</span><span style="color: #007700">return&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #FF8000">#&#xA0;A&#xA0;much&#xA0;simpler&#xA0;and&#xA0;less&#xA0;verbose&#xA0;version&#xA0;of&#xA0;the&#xA0;above&#xA0;function&#xA0;would&#xA0;be:<br></span><span style="color: #007700">function&#xA0;</span><span style="color: #0000BB">reverse_fn_fast</span><span style="color: #007700">(</span><span style="color: #0000BB">$job</span><span style="color: #007700">)<br>{<br>&#xA0;&#xA0;return&#xA0;</span><span style="color: #0000BB">strrev</span><span style="color: #007700">(</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">workload</span><span style="color: #007700">());<br>}<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output
something similar to:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
% php reverse_worker.php
Starting
Waiting for job...
Received job: H:foo.local:41
Workload: this is a test (14)
1/14 complete
2/14 complete
3/14 complete
4/14 complete
5/14 complete
6/14 complete
7/14 complete
8/14 complete
9/14 complete
10/14 complete
11/14 complete
12/14 complete
13/14 complete
14/14 complete
Result: tset a si siht
</pre></div>
    </div>
    <div class="example-contents screen">
<div class="cdata"><pre>
% php reverse_client_bg.php
done!
</pre></div>
    </div>
   </div>
  </p>
 