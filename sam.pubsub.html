---
layout: default
---

  <h2 class="title">Publish/Subscribe and subscriptions to topics</h2>
  <p class="para">
   SAM allows messages to be sent either to queues or, for WebSphere MQ
   and WPM, to publish/subscribe topics.
   A topic destination is specified to SAM in the usual way, i.e. in the
   form &apos;topic://fred&apos;, rather than the form &apos;queue://AQUEUE&apos; used for
   point to point operation. To use publish/subscribe it is simply
   necessary to specify the correct broker name on the SAMConnect
   &quot;connect&quot; call and the desired topic in the destination argument to
   the SAMConnect &quot;send&quot; and &quot;receive&quot; calls. The PHP interface is
   otherwise identical to the point to point model.
  </p>
  <p class="para">
   By default, SAM creates non-durable subscriptions when using
   publish/subscribe. This means that if a client application is
   inactive when messages are published to a topic, then it will not
   receive them when it subsequently restarted. SAM does also allow
   durable subscriptions to be made to topics when using WPM or WebSphere
   MQ publish/subscribe. The purpose of these subscriptions is to allow
   data to be received by a client application even if that client was not
   active at the time the data was published.
  </p>
  <p class="para">
   Durable subscriptions are specified by using the SAMConnect &quot;subscribe&quot;
   call. This method takes the destination topic as an input parameter and
   returns a subscription identifier that may be used on subsequent
   &quot;receive&quot; calls. When the subscription is no longer required the
   SAMConnection &quot;unsubscribe&quot; method should be used to delete the
   subscription.
  </p>
  <p class="para">
   <div class="example" id="example-5065">
    <p><strong>Example #1 Creating a durable subscription to a topic</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$subName&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">subscribe</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;topic://A&apos;</span><span style="color: #007700">);<br><br>if&#xA0;(!</span><span style="color: #0000BB">$subName</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Subscribe&#xA0;failed&quot;</span><span style="color: #007700">;<br>}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">#&#xA0;Subscribe&#xA0;was&#xA0;OK<br>&#xA0;&#xA0;&#xA0;//&#xA0;...<br></span><span style="color: #007700">}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5066">
    <p><strong>Example #2 Subscribing to a topic using a WebSphere Platform Messaging (WPM) server</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$conn&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">SAMConnection</span><span style="color: #007700">();<br></span><span style="color: #FF8000">//&#xA0;Note:&#xA0;For&#xA0;pub/sub&#xA0;on&#xA0;WPM,&#xA0;when&#xA0;connecting&#xA0;the&#xA0;name&#xA0;of&#xA0;a&#xA0;messaging&#xA0;engine<br>//&#xA0;&#xA0;&#xA0;to&#xA0;hold&#xA0;the&#xA0;durable&#xA0;subscription&#xA0;(SAM_WPM_DUR_SUB_HOME)&#xA0;must&#xA0;be&#xA0;specified.<br></span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">connect</span><span style="color: #007700">(</span><span style="color: #0000BB">SAM_WMQ</span><span style="color: #007700">,&#xA0;array(</span><span style="color: #0000BB">SAM_ENDPOINTS&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&apos;localhost:7278:BootstrapBasicMessaging&apos;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">SAM_BUS&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&apos;Bus1&apos;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">SAM_TARGETCHAIN&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&apos;InboundBasicMessaging&apos;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">SAM_WPM_DUR_SUB_HOME&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&apos;MyMachineNode01.server1-Bus1&apos;</span><span style="color: #007700">));<br><br></span><span style="color: #0000BB">$subName&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">subscribe</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;topic://A&apos;</span><span style="color: #007700">);<br><br>if&#xA0;(!</span><span style="color: #0000BB">$subName</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Subscribe&#xA0;failed&quot;</span><span style="color: #007700">;<br>}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">#&#xA0;Subscribe&#xA0;was&#xA0;OK<br>&#xA0;&#xA0;&#xA0;//&#xA0;...<br></span><span style="color: #007700">}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5067">
    <p><strong>Example #3 Receiving published data using a durable subscription</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$msg&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">receive</span><span style="color: #007700">(</span><span style="color: #0000BB">$subName</span><span style="color: #007700">);<br>if&#xA0;(</span><span style="color: #0000BB">$msg</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Received&#xA0;a&#xA0;message&#xA0;OK&quot;</span><span style="color: #007700">;<br>}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;The&#xA0;receive&#xA0;failed&quot;</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-5068">
    <p><strong>Example #4 Deleting a durable subscription to a topic</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">if&#xA0;(!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unsubscribe</span><span style="color: #007700">(</span><span style="color: #0000BB">$subName</span><span style="color: #007700">))&#xA0;{<br>&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Unsubscribe&#xA0;failed&quot;</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 