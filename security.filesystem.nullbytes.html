---
layout: default
---

    <h2 class="title">Null bytes related issues</h2>
    <p class="simpara">
     As <acronym title="PHP: Hypertext Preprocessor">PHP</acronym> uses the underlying C functions for filesystem related
     operations, it may handle null bytes in a quite unexpected way.
     As null bytes denote the end of a string in C, strings containing them 
     won&apos;t be considered entirely but rather only until a null byte occurs.

     The following example shows a vulnerable code that demonstrates this problem:
    </p>
    <div class="example" id="example-356">
     <p><strong>Example #1 Script vulnerable to null bytes</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$file&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;file&apos;</span><span style="color: #007700">];&#xA0;</span><span style="color: #FF8000">//&#xA0;&quot;../../etc/passwd\0&quot;<br></span><span style="color: #007700">if&#xA0;(</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;/home/wwwrun/&apos;</span><span style="color: #007700">.</span><span style="color: #0000BB">$file</span><span style="color: #007700">.</span><span style="color: #DD0000">&apos;.php&apos;</span><span style="color: #007700">))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;file_exists&#xA0;will&#xA0;return&#xA0;true&#xA0;as&#xA0;the&#xA0;file&#xA0;/home/wwwrun/../../etc/passwd&#xA0;exists<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">include&#xA0;</span><span style="color: #DD0000">&apos;/home/wwwrun/&apos;</span><span style="color: #007700">.</span><span style="color: #0000BB">$file</span><span style="color: #007700">.</span><span style="color: #DD0000">&apos;.php&apos;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;the&#xA0;file&#xA0;/etc/passwd&#xA0;will&#xA0;be&#xA0;included<br></span><span style="color: #007700">}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
    <p class="para">
     Therefore, any tainted string that is used in a filesystem operation should always
     be validated properly. Here is a better version of the previous example:
    </p>
    <div class="example" id="example-357">
     <p><strong>Example #2 Correctly validating the input</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$file&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;file&apos;</span><span style="color: #007700">];&#xA0;<br><br></span><span style="color: #FF8000">//&#xA0;Whitelisting&#xA0;possible&#xA0;values<br></span><span style="color: #007700">switch&#xA0;(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;case&#xA0;</span><span style="color: #DD0000">&apos;main&apos;</span><span style="color: #007700">:<br>&#xA0;&#xA0;&#xA0;&#xA0;case&#xA0;</span><span style="color: #DD0000">&apos;foo&apos;</span><span style="color: #007700">:<br>&#xA0;&#xA0;&#xA0;&#xA0;case&#xA0;</span><span style="color: #DD0000">&apos;bar&apos;</span><span style="color: #007700">:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;include&#xA0;</span><span style="color: #DD0000">&apos;/home/wwwrun/include/&apos;</span><span style="color: #007700">.</span><span style="color: #0000BB">$file</span><span style="color: #007700">.</span><span style="color: #DD0000">&apos;.php&apos;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;break;<br>&#xA0;&#xA0;&#xA0;&#xA0;default:<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;include&#xA0;</span><span style="color: #DD0000">&apos;/home/wwwrun/include/main.php&apos;</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
     </div>

    </div>
   