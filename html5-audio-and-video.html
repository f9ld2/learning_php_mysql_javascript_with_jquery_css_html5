---
layout: default
title: "HTML5 Audio and Video"
---
<h2>HTML5 Audio and Video</h2>
<span>One of the biggest driving forces behind the growth of the Internet has been the insa‐</span>
<span>tiable demand from users for ever more multimedia in the form of audio and video.</span>
<span>Initially, bandwidth was so precious that there was no such thing as live streaming,</span>
<span>and it could take minutes or even hours to download an audio track, let alone a video.</span>
<br/>
<span>The high cost of bandwidth and limited availability of fast modems drove the devel‐</span>
<span>opment of faster and more efficient compression algorithms, such as MP3 audio and</span>
<span>MPEG video, but even then the only way to download files in any reasonable length</span>
<span>of time was to drastically reduce their quality.</span>
<br/>
<span>One of my earlier Internet projects, back in 1997, was the UK&rsquo;s first online radio sta‐</span>
<span>tion licensed by the music authorities. Actually, it was more of a podcast (before the</span>
<span>term was coined) because we made a daily half-hour show and then compressed it</span>
<span>down to 8-bit, 11KHz mono using an algorithm originally developed for telephony,</span>
<span>and it sounded like phone quality, or worse. Still, we quickly gained thousands of lis‐</span>
<span>teners who would download the show and then listen to it as they surfed to the sites</span>
<span>discussed in it by means of a pop-up browser window containing a plug-in.</span>
<br/>
<span>Thankfully for us, and everyone publishing multimedia, it soon became possible to</span>
<span>offer greater audio and video quality, but still only by asking the user to download</span>
<span>and install a plug-in player. Flash became the most popular of these players, after</span>
<span>beating rivals such as RealAudio, but it gained a bad reputation as the cause of many a</span>
<span>browser crash, and constantly required upgrading when new versions were released.</span>
<br/>
<span>So it was generally agreed that the way ahead was to come up with some web stand‐</span>
<span>ards for supporting multimedia directly within the browser. Of course, browser</span>
<span>developers such as Microsoft and Google had differing visions of what these stand‐</span>
<span>ards should look like, but after the dust had settled, they had agreed on a subset of file</span>
<span>types that all browsers should play natively, and these were introduced into the</span>
<span>HTML5 specification.</span>
<br/>
<span>Finally, it is possible (as long as you encode your audio and video in a few different</span>
<span>formats) to upload multimedia to a web server, place a couple of HTML tags in a web</span>
<span>page, and have the media play on any major desktop browser, smartphone, or tablet</span>
<span>device, without the user having to download a plug-in or make any other changes.</span>
<br/>
<span>There are still a lot of older browsers out there, so Flash remains</span>
<span>important for supporting them. In this chapter, I show you how to</span>
<span>add code to use Flash as a backup to HTML5 audio and video, to</span>
<span>cover as many hardware and software combinations as possible.</span>
<h3>About Codecs</h3>
<span>The term</span>
<span>codec</span>
<span>stands for en</span>
<span>co</span>
<span>der/</span>
<span>dec</span>
<span>oder. It describes the functionality provided by</span>
<span>software that encodes and decodes media such as audio and video. In HTML5 there</span>
<span>are a number of different sets of codecs available, depending on the browser used.</span>
<br/>
<span>Following are the codecs supported by the HTML5</span>
<span>&lt;audio&gt;</span>
<span>tag (and also when audio</span>
<span>is attached to HTML5 video):</span>
<br/>
<span>AAC</span>
<div class="t30">This audio codec, which stands for Advanced Audio Encoding, is used by Apple&rsquo;s
iTunes store, and is a proprietary patented technology supported by Apple, Google,
and Microsoft. It generally uses the
.aac
file extension. Its mime type is
audio/aac.</div>
<span>MP3</span>
<div class="t30">This audio codec, which stands for MPEG Audio Layer 3, has been available for
many years. While the term is often (incorrectly) used to refer to any type of digital
audio, it is a proprietary patented technology that is supported by Apple, Google,
Mozilla Firefox, and Microsoft. The file extension it uses is
&nbsp;.mp3
. Its mime type is
audio/mpeg.</div>
<span>PCM</span>
<div class="t30">This audio codec, which stands for Pulse Coded Modulation, stores the full data as
encoded by an analog-to-digital converter, and is the format used for storing data on
audio CDs. Because it does not use compression, it is called a
lossless
codec and its
files are generally many times larger than AAC or MP3 files. It is supported by Apple,
Mozilla Firefox, and Opera. Usually this type of file has the extension
.wav
. Its mime
type is
audio/wav
, but you may also see
audio/wave.</div>
<span>Vorbis</span>
<div class="t30">Sometimes referred to as Ogg Vorbis&mdash;because it generally uses the
.ogg
file extension
&mdash;
this audio codec is unencumbered by patents and free of royalty payments. It is
supported by Google Chrome, Mozilla Firefox, and Opera. Its mime type is
audio/
ogg
, or sometimes
audio/oga.</div>
<br/>
<span>The following list summarizes the major operating systems and browsers, along with</span>
<span>the audio types their latest versions support:</span>
<br/>
<span>&bull;</span>
<b>Apple iOS</b>
<span>: AAC, MP3, PCM</span>
<br/>
<span>&bull;</span>
<b>Apple Safari</b>
<span>: AAC, MP3, PCM</span>
<br/>
<span>&bull;</span>
<b>Google Android</b>
<span>: 2.3+ AAC, MP3, Vorbis</span>
<br/>
<span>&bull;</span>
<b>Google Chrome</b>
<span>: AAC, MP3, Vorbis</span>
<br/>
<span>&bull;</span>
<b>Microsoft Internet Explorer</b>
<span>: AAC, MP3</span>
<br/>
<span>&bull;</span>
<b>Mozilla Firefox</b>
<span>: MP3, PCM, Vorbis</span>
<br/>
<span>&bull;</span>
<b>Opera</b>
<span>: PCM, Vorbis</span>
<br/>
<span>The outcome of these different levels of codec support is that you always need at least</span>
<span>two versions of each audio file to ensure it will play on all platforms. One of these</span>
<span>should be Vorbis to support Opera, but for the second you have a choice of either</span>
<span>AAC or MP3.</span>
<h3>The &lt;audio&gt; Element</h3>
<span>To cater to all platforms, you need to record or convert your content using multiple</span>
<span>codecs and then list them all within</span>
<span>&lt;audio&gt;</span>
<span>and</span>
<span>&lt;/audio&gt;</span>
<span>tags, as in</span>
<span>Example 24-1</span>
<span>.</span>
<span>The nested</span>
<span>&lt;source&gt;</span>
<span>tags then contain the various media you wish to offer to a</span>
<span>browser. Because the</span>
<span>controls</span>
<span>attribute is supplied, the result looks like</span>
<span>Figure 24-1</span>
<span>.</span>
<br/>
<span>Example 24-1. Embedding three</span>
<span>different types of audio files</span>
<pre>
<code class="html">
&lt;audio controls&gt;
&lt;source src='audio.m4a' type='audio/aac'&gt;
&lt;source src='audio.mp3' type='audio/mp3'&gt;
&lt;source src='audio.ogg' type='audio/ogg'&gt;
&lt;/audio&gt;
</code>
</pre>
<p><img src="images/24.1.png"/></p>
<span>Figure 24-1. Playing an audio file</span>
<br/>
<span>In this example I included three different audio types, because that&rsquo;s perfectly accepta‐</span>
<span>ble, and can be a good idea if you wish to ensure that each browser can locate its pre‐</span>
<span>ferred format rather than just one it knows how to handle. However, the example will</span>
<span>still play on all platforms if one or the other (but not both) of the MP3 or the AAC</span>
<span>files is dropped.</span>
<br/>
<span>The</span>
<span>&lt;audio&gt;</span>
<span>element and its partner</span>
<span>&lt;source&gt;</span>
<span>tag support several attributes:</span>
<br/>
<span>autoplay</span>
<div class="t30">Causes the audio to start playing as soon as it is ready</div>
<span>controls</span>
<div class="t30">Causes the control panel to be displayed</div>
<span>loop</span>
<div class="t30">Sets the audio to play over and over</div>
<span>preload</span>
<div class="t30">Causes the audio to begin loading even before the user selects Play</div>
<span>src</span>
<div class="t30">Specifies the source location of an audio file</div>
<span>type</span>
<div class="t30">Specifies the codec used in creating the audio</div>
<br/>
<span>If you don&rsquo;t supply the</span>
<span>controls</span>
<span>attribute to the</span>
<span>&lt;audio&gt;</span>
<span>tag, and don&rsquo;t use the</span>
<span>auto</span>
<span>play</span>
<span>attribute either, the sound will not play and there won&rsquo;t be a Play button for the</span>
<span>user to click to start playback. This would leave you no option other than to offer this</span>
<span>functionality in JavaScript, as in</span>
<span>&nbsp;Example 24-2</span>
<span>&nbsp;(with the additional code required</span>
<span>highlighted in bold), which provides the ability to play and pause the audio, as shown</span>
<span>in</span>
<span>Figure 24-2</span>
<span>.</span>
<br/>
<span>Example 24-2. Playing audio using JavaScript</span>
<pre>
<code class="html">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Playing Audio with JavaScript&lt;/title&gt;
        &lt;script src='OSC.js'&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;audio
        id='myaudio'
        &gt;
        &lt;source src='audio.m4a' type='audio/aac'&gt;
        &lt;source src='audio.mp3' type='audio/mp3'&gt;
        &lt;source src='audio.ogg' type='audio/ogg'&gt;
        &lt;/audio&gt;
        &lt;button onclick='playaudio()'&gt;Play Audio&lt;/button&gt;
        &lt;button onclick='pauseaudio()'&gt;Pause Audio&lt;/button&gt;
        &lt;script&gt;
            function playaudio()
            {
                O('myaudio').play()
            }
            function pauseaudio()
            {
                O('myaudio').pause()
            }
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code>
</pre>
<p><img src="images/24.2.png"/></p>
<span>Figure 24-2. HTML5 audio can be controlled with JavaScript</span>
<br/>
<span>This works by calling the</span>
<span>play</span>
<span>or</span>
<span>pause</span>
<span>methods of the</span>
<span>myaudio</span>
<span>element when the</span>
<span>buttons are clicked.</span>
<h3>Supporting Non-HTML5 Browsers</h3>
<span>It will probably be necessary to support older browsers for the foreseeable future by</span>
<span>providing a fallback to Flash.</span>
<span>Example 24-3</span>
<span>shows how you can do this using a Flash</span>
<span>plug-in saved as</span>
<span>&nbsp;audioplayer.swf</span>
<span>&nbsp;(available, along with all the examples, in the free</span>
<span>download at the</span>
<span>http://lpmj.net</span>
<span>companion website). The code to add is highlighted</span>
<span>in bold.</span>
<br/>
<span>Example 24-3. Providing a Flash fallback for non-HTML5 browsers</span>
<pre>
<code class="html">
&lt;audio controls&gt;
&lt;object type="application/x-shockwave-flash"
data="audioplayer.swf" width="300" height="30"&gt;
&lt;param name="FlashVars"
value="mp3=audio.mp3&amp;showstop=1&amp;showvolume=1"&gt;
&lt;/object&gt;
&lt;source src='audio.m4a' type='audio/aac'&gt;
&lt;source src='audio.mp3' type='audio/mp3'&gt;
&lt;source src='audio.ogg' type='audio/ogg'&gt;
&lt;/audio&gt;
</code>
</pre>
<span>Here we take advantage of the fact that on non-HTML5 browsers, anything inside the</span>
<span>&lt;audio&gt;</span>
<span>tag (other than the</span>
<span>&lt;source&gt;</span>
<span>elements, which are ignored) will be acted on</span>
<span>by the browser. Therefore, by placing an</span>
<span>&lt;object&gt;</span>
<span>element there that calls up a Flash</span>
<span>player, we ensure that any non-HTML5 browsers will at least have a chance of playing</span>
<span>the audio, as long as they have Flash installed, as shown in</span>
<span>Figure 24-3</span>
<span>.</span>
<br/>
<p><img src="images/24.3.png"/></p>
<span>Figure 24-3. The Flash audio player has been loaded</span>
<br/>
<span>The particular audio player used in this example,</span>
<span>audioplayer.swf</span>
<span>, takes the following</span>
<span>arguments and values to the</span>
<span>FlashVars</span>
<span>attribute of the</span>
<span>&lt;param&gt;</span>
<span>element:</span>
<br/>
<span>mp3</span>
<div class="t30">The URL of an MP3 audio file.</div>
<span>showstop</span>
<div class="t30">If 1, shows the Stop button; otherwise, it is not displayed.</div>
<span>showvolume</span>
<div class="t30">If 1, shows the volume bar; otherwise, it is not displayed.</div>
<br/>
<span>As with many elements, you can easily resize the object to (for example) 300&times;30 pix‐</span>
<span>els by providing these values to its</span>
<span>width</span>
<span>and</span>
<span>height</span>
<span>attributes.</span>
<h3>The &lt;video&gt; Element</h3>
<span>Playing video in HTML5 is quite similar to audio; you just use the</span>
<span>&lt;video&gt;</span>
<span>tag and</span>
<span>provide</span>
<span>&lt;source&gt;</span>
<span>elements for the media you are offering.</span>
<span>Example 24-4</span>
<span>shows how</span>
<span>you do this with three different video codec types, as displayed in</span>
<span>Figure 24-4</span>
<span>.</span>
<br/>
<span>Example 24-4. Playing HTML5 video</span>
<pre>
<code class="html">
&lt;video width='560' height='320' controls&gt;
&lt;source src='movie.mp4' type='video/mp4'&gt;
&lt;source src='movie.webm' type='video/webm'&gt;
&lt;source src='movie.ogv' type='video/ogg'&gt;
&lt;/video&gt;
</code>
</pre>
<p><img src="images/24.4.jpeg"/></p>
<span>Figure 24-4. Playing HTML5 video</span>
<h4>The Video Codecs</h4>
<span>As with audio, there are a number of video codecs available, with differing support</span>
<span>across multiple browsers. These codecs come in different containers, as follows:</span>
<br/>
<span>MP4</span>
<div class="t30">A license-encumbered, multimedia container format standard specified as a part of
MPEG-4, supported by Apple, Microsoft, and, to a lesser extent Google, since it has its own WebM container format. Its mime type is video/mp4.</div>
<span>OGG</span>
<div class="t30">A free, open container format maintained by the Xiph.Org Foundation. The creators
of the OGG format state that it is unrestricted by software patents and is designed to
provide for efficient streaming and manipulation of high-quality digital multimedia.
Its mime type is video/ogg , or sometimes video/ogv.</div>
<span>WebM</span>
<div class="t30">An audio-video format designed to provide a royalty-free, open video compression
format for use with HTML5 video. The project&rsquo;s development is sponsored by Google. There are two versions: VP8 and the newer VP9. Its mime type is video/webm.</div>
<br/>
<span>These may then contain one of the following video codecs:</span>
<br/>
<span>H.264</span>
<div class="t30">A patented, proprietary video codec for which playback is free for the end user, but
which may incur royalty fees for all parts of the encoding and transmission process.
At the time of writing, all of Apple, Google, Mozilla Firefox, and Microsoft Internet
Explorer support this codec, while Opera (the remaining major browser) doesn&rsquo;t.</div>
<span>Theora</span>
<div class="t30">This is a video codec unencumbered by patents, and free of royalty payments at all
levels of encoding, transmission, and playback. This codec is supported by Google Chrome, Mozilla Firefox, and Opera.</div>
<span>VP8</span>
<div class="t30">This video codec is similar to Theora but is owned by Google, which has published it
as open source, making it royalty free. It is supported by Google Chrome, Mozilla Firefox, and Opera.</div>
<span>VP9</span>
<div class="t30">As VP8 but more powerful, using half the bitrate.</div>
<br/>
<span>The following list details the major operating systems and browsers, along with the</span>
<span>video types their latest versions support:</span>
<span>&bull;</span>
<b>Apple iOS</b>
<span>: MP4/H.264</span>
<br/>
<span>&bull;</span>
<b>Apple Safari</b>
<span>: MP4/H.264</span>
<br/>
<span>&bull;</span>
<b>Google Android</b>
<span>: MP4, OGG, WebM/H.264, Theora, VP8</span>
<br/>
<span>&bull;</span>
<b>Google Chrome</b>
<span>: MP4, OGG, WebM/H.264, Theora, VP8, VP9</span>
<br/>
<span>&bull;</span>
<b>Internet Explorer</b>
<span>: MP4/H.264</span>
<br/>
<span>&bull;</span>
<b>Mozilla Firefox</b>
<span>: MP4, OGG, WebM/H.264, Theora, VP8, VP9</span>
<br/>
<span>&bull;</span>
<b>Opera</b>
<span>: OGG, WebM/Theora, VP8</span>
<br/>
<span>Looking at this list, it&rsquo;s clear that MP4/H.264 is almost unanimously supported,</span>
<span>except for the Opera browser. So if you&rsquo;re prepared to ignore the 1 percent or so of</span>
<span>users this comprises (and hope that Opera will soon have to adopt the format any‐</span>
<span>way), you need to supply your video using only one file type: MP4/H.264. But for</span>
<span>maximum viewing, you really ought to encode in OGG/Theora or OGG/VP8 as well</span>
<span>(but not VP9, as it&rsquo;s not yet been adopted by Opera).</span>
<br/>
<span>Therefore, the</span>
<span>movie.webm</span>
<span>file in</span>
<span>Example 24-4</span>
<span>isn&rsquo;t strictly needed, but shows how</span>
<span>you can add all the different file types you like, to give browsers the opportunity to</span>
<span>play back the formats they prefer.</span>
<br/>
<span>The</span>
<span>&lt;video&gt;</span>
<span>element</span>
<span>and</span>
<span>accompanying</span>
<span>&lt;source&gt;</span>
<span>tag</span>
<span>support</span>
<span>the</span>
<span>following</span>
<span>attributes:</span>
<br/>
<span>autoplay</span>
<div class="t30">Causes the video to start playing as soon as it is ready</div>
<span>controls</span>
<div class="t30">Causes the control panel to be displayed</div>
<span>height</span>
<div class="t30">Specifies the height at which to display the video</div>
<span>loop</span>
<div class="t30">Sets the video to play over and over</div>
<span>muted</span>
<div class="t30">Mutes the audio output</div>
<span>poster</span>
<div class="t30">Lets you choose an image to display where the video will play</div>
<span>preload</span>
<div class="t30">Causes the video to begin loading before the user selects Play</div>
<span>src</span>
<div class="t30">Specifies the source location of a video file</div>
<span>type</span>
<div class="t30">Specifies the codec used in creating the video</div>
<span>width</span>
<div class="t30">Specifies the width at which to display the video</div>
<br/>
<span>If you wish to control video playback from JavaScript, you can do so using code such</span>
<span>as that in</span>
<span>Example 24-5</span>
<span>(with the additional code required highlighted in bold), and</span>
<span>shown in</span>
<span>Figure 24-5</span>
<span>.</span>
<br/>
<span>Example 24-5. Controlling video playback from JavaScript</span>
<pre>
<code class="html">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Playing Video with JavaScript&lt;/title&gt;
        &lt;script src='OSC.js'&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;video
        id='myvideo'
        width='560' height='320'&gt;
        &lt;source src='movie.mp4' type='video/mp4'&gt;
        &lt;source src='movie.webm' type='video/webm'&gt;
        &lt;source src='movie.ogv' type='video/ogg'&gt;
        &lt;/video&gt;&lt;br&gt;
        &lt;button onclick='playvideo()'&gt;Play Video&lt;/button&gt;
        &lt;button onclick='pausevideo()'&gt;Pause Video&lt;/button&gt;
        &lt;script&gt;
            function playvideo()
            {
                O('myvideo').play()
            }
            function pausevideo()
            {
                O('myvideo').pause()
            }
        &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code>
</pre>
<p><img src="images/24.5.jpeg"/></p>
<span>Figure 24-5. JavaScript is being used to control the video</span>
<br/>
<span>This code is just like controlling audio from JavaScript. Simply call the</span>
<span>play</span>
<span>and/or</span>
<span>pause</span>
<span>methods of the</span>
<span>myvideo</span>
<span>object to play and pause the video.</span>
<h4>Supporting Older Browsers</h4>
<span>Also as with audio, older versions of browsers will still be in general use for a while to</span>
<span>come, so it makes sense to offer a Flash video fallback to people with non-HTML5</span>
<span>browsers.</span>
<span>&nbsp;Example 24-6</span>
<span>&nbsp;shows you how to do this (highlighted in bold) using the</span>
<span>flowplayer.swf</span>
<span>file (available in the free download at</span>
<span>http://lpmj.net</span>
<span>), and</span>
<span>Figure 24-6</span>
<span>shows how it displays in a browser that doesn&rsquo;t support HTML5 video.</span>
<br/>
<span>Example 24-6. Providing Flash as a fallback video player</span>
<pre>
<code class="html">
&lt;video width='560' height='320' controls&gt;
    &lt;object width='560' height='320'
        type='application/x-shockwave-flash'
        data='flowplayer.swf'&gt;
        &lt;param name='movie' value='flowplayer.swf'&gt;
        &lt;param name='flashvars'
        value='config={"clip": {"url": "http://tinyurl.com/html5video-mp4", "autoPlay":false, "autoBuffering":true}}'&gt;
    &lt;/object&gt;
    &lt;source src='movie.mp4' type='video/mp4'&gt;
    &lt;source src='movie.webm' type='video/webm'&gt;
    &lt;source src='movie.ogv' type='video/ogg'&gt;
&lt;/video&gt;
</code>
</pre>
<p><img src="images/24.6.jpeg"/></p>
<span>Figure 24-6. Flash provides a handy fallback for non-HTML5 browsers</span>
<br/>
<span>This Flash video player is particular about security, so it won&rsquo;t play videos from a local</span>
<span>file system, only from a web server, so I have supplied a file on the Web (at</span>
<span>tinyurl.com/html5video-mp4</span>
<span>) for this example to play.</span>
<span>Here are the argument s to supply to the</span>
<span>flashvars</span>
<span>attribute of the</span>
<span>&lt;param&gt;</span>
<span>element:</span>
<br/>
<span>url</span>
<div class="t30">A URL on a web server of a .mp4 file to play.</div>
<span>autoPlay</span>
<div class="t30">If true, plays automatically; otherwise, waits for the Play button to be clicked.</div>
<span>autoBuffering</span>
<div class="t30">If true, in order to minimize buffering later on with slow connections, before it starts
playing, the video will be preloaded sufficiently for the available bandwidth.</div>
<br/>
<span>For more information on the Flash</span>
<span>flowplayer</span>
<span>&nbsp;program (and an</span>
<span>HTML5 version), check out</span>
<span>http://flowplayer.org</span>
<span>.</span>