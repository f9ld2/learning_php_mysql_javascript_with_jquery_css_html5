---
layout: default
---

  <h2 class="title">Usage</h2>
  <p class="para">
   After associating a MySQL connection with a Memcache connection using 
   <span class="function"><strong>mysqnd_memcache_set()</strong></span> the plugin attempts to transparently
   replace SQL <em>SELECT</em>
   statements by a memcache access. For that purpose the plugin monitors
   all SQL statements executed and tries to match the statement string
   against <strong><code>MYSQLND_MEMCACHE_DEFAULT_REGEXP</code></strong>.
   In case of a match, the mysqlnd memcache plugin checks whether the
   <em>SELECT</em> is accessing only columns of a mapped table and
   the <em>WHERE</em> clause is limited to a single key lookup.
  </p>
  <p class="para">
   In case of the example SQL table, the plugin will use the Memcache interface
   of the MySQL server to fetch results for a SQL query like
   <em>SELECT f1, f2, f3 WHERE id = n</em>.
  </p>
  <p class="para">
   <div class="example" id="example-2177">
    <p><strong>Example #1 
     Basic example.</strong></p>

    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$mysqli&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">mysqli</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;host&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;user&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;passwd&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;database&quot;</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$memc&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">Memcached</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$memc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServer</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;host&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">11211</span><span style="color: #007700">);<br></span><span style="color: #0000BB">mysqlnd_memcache_set</span><span style="color: #007700">(</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$memc</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*<br>&#xA0;&#xA0;&#xA0;This&#xA0;is&#xA0;a&#xA0;query&#xA0;which&#xA0;queries&#xA0;table&#xA0;test&#xA0;using&#xA0;id&#xA0;as&#xA0;key&#xA0;in&#xA0;the&#xA0;WHERE&#xA0;part<br>&#xA0;&#xA0;&#xA0;and&#xA0;is&#xA0;accessing&#xA0;fields&#xA0;f1,&#xA0;f2&#xA0;and&#xA0;f3.&#xA0;Therefore,&#xA0;mysqlnd_memcache<br>&#xA0;&#xA0;&#xA0;will&#xA0;intercept&#xA0;it&#xA0;and&#xA0;route&#xA0;it&#xA0;via&#xA0;memcache.<br>*/<br></span><span style="color: #0000BB">$result&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;SELECT&#xA0;f1,&#xA0;f2,&#xA0;f3&#xA0;FROM&#xA0;test&#xA0;WHERE&#xA0;id&#xA0;=&#xA0;1&quot;</span><span style="color: #007700">);<br>while&#xA0;(</span><span style="color: #0000BB">$row&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_row</span><span style="color: #007700">())&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #FF8000">/*<br>&#xA0;&#xA0;&#xA0;This&#xA0;is&#xA0;a&#xA0;query&#xA0;which&#xA0;queries&#xA0;table&#xA0;test&#xA0;but&#xA0;using&#xA0;f1&#xA0;in&#xA0;the&#xA0;WHERE&#xA0;clause.<br>&#xA0;&#xA0;&#xA0;Therefore,&#xA0;mysqlnd_memcache&#xA0;can&apos;t&#xA0;intercept&#xA0;it.&#xA0;This&#xA0;will&#xA0;be&#xA0;executed<br>&#xA0;&#xA0;&#xA0;using&#xA0;the&#xA0;MySQL&#xA0;protocol<br>*/<br></span><span style="color: #0000BB">$mysqli</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;SELECT&#xA0;id&#xA0;FROM&#xA0;test&#xA0;WHERE&#xA0;f1&#xA0;=&#xA0;&apos;Lady&apos;&quot;</span><span style="color: #007700">);<br>while&#xA0;(</span><span style="color: #0000BB">$row&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fetch_row</span><span style="color: #007700">())&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">print_r</span><span style="color: #007700">(</span><span style="color: #0000BB">$row</span><span style="color: #007700">);<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>The above example will output:</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
array(
    [f1] =&gt; Hello
    [f2] =&gt; World
    [f3] =&gt; !
)
array(
    [id] =&gt; 2
)
</pre></div>
    </div>
   </div>
  </p>

 