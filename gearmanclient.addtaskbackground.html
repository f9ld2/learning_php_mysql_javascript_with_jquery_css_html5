---
layout: default
---

 <div class="refnamediv">
  <h1 class="refname">GearmanClient::addTaskBackground</h1>
  <p class="verinfo">(PECL gearman &gt;= 0.5.0)</p><p class="refpurpose"><span class="refname">GearmanClient::addTaskBackground</span> &#x2014; <span class="dc-title">Add a background task to be run in parallel</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-gearmanclient.addtaskbackground-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type"><a href="class.gearmantask.html" class="type GearmanTask">GearmanTask</a></span> <span class="methodname"><strong>GearmanClient::addTaskBackground</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$function_name</code></span>
   , <span class="methodparam"><span class="type">string</span> <code class="parameter">$workload</code></span>
   [, <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter reference">&amp;$context</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$unique</code></span>
  ]] )</div>

  <p class="para rdfs-comment">
   Adds a background task to be run in parallel with other tasks.  Call this method for all the tasks
   to be run in parallel, then call <span class="methodname"><a href="gearmanclient.runtasks.html" class="methodname">GearmanClient::runTasks()</a></span> to
   perform the work.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-gearmanclient.addtaskbackground-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">function_name</code></dt>

     <dd>

      <p class="para">
       A registered function the worker is to execute
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">workload</code></dt>

     <dd>

      <p class="para">
       Serialized data to be processed
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">context</code></dt>

     <dd>

      <p class="para">
       Application context to associate with a task
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">unique</code></dt>

     <dd>

      <p class="para">
       A unique ID used to identify a particular task
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-gearmanclient.addtaskbackground-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   A <a href="class.gearmantask.html" class="classname">GearmanTask</a> object or <strong><code>FALSE</code></strong> if the task could not be added.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-gearmanclient.addtaskbackground-examples">
  <h3 class="title">Examples</h3>
  <p class="para">
   <div class="example" id="example-4901">
    <p><strong>Example #1 Two tasks, one background and one not</strong></p>
    <div class="example-contents"><p>
     This example illustrates the difference between running a background task
     and a normal task.  The client adds two tasks to execute the same function,
     but one is added with <span class="methodname"><strong>addTaskBackground()</strong></span>.  A callback is 
     set so that progress of the job can be tracked.  A simple worker with an
     artificial delay reports on the job progress and the client picks this up
     through the callback.  Two workers are run for this example.  Note that the
     background task does not show in the client output.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">#&#xA0;The&#xA0;client&#xA0;script<br><br>#&#xA0;create&#xA0;our&#xA0;gearman&#xA0;client<br></span><span style="color: #0000BB">$gmc</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">GearmanClient</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;add&#xA0;the&#xA0;default&#xA0;job&#xA0;server<br></span><span style="color: #0000BB">$gmc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServer</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;set&#xA0;a&#xA0;couple&#xA0;of&#xA0;callbacks&#xA0;so&#xA0;we&#xA0;can&#xA0;track&#xA0;progress<br></span><span style="color: #0000BB">$gmc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setCompleteCallback</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;reverse_complete&quot;</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$gmc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setStatusCallback</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;reverse_status&quot;</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">#&#xA0;add&#xA0;a&#xA0;task&#xA0;for&#xA0;the&#xA0;&quot;reverse&quot;&#xA0;function<br></span><span style="color: #0000BB">$task</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$gmc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addTask</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;reverse&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;Hello&#xA0;World!&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;1&quot;</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">#&#xA0;add&#xA0;another&#xA0;task,&#xA0;but&#xA0;this&#xA0;one&#xA0;to&#xA0;run&#xA0;in&#xA0;the&#xA0;background<br></span><span style="color: #0000BB">$task</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$gmc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addTaskBackground</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;reverse&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;!dlroW&#xA0;olleH&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">null</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;2&quot;</span><span style="color: #007700">);<br><br>if&#xA0;(!&#xA0;</span><span style="color: #0000BB">$gmc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">runTasks</span><span style="color: #007700">())<br>{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;ERROR&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$gmc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;exit;<br>}<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;DONE\n&quot;</span><span style="color: #007700">;<br><br>function&#xA0;</span><span style="color: #0000BB">reverse_status</span><span style="color: #007700">(</span><span style="color: #0000BB">$task</span><span style="color: #007700">)<br>{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;STATUS:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$task</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unique</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;,&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$task</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">jobHandle</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;&#xA0;-&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$task</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">taskNumerator</span><span style="color: #007700">()&#xA0;.&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;/&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$task</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">taskDenominator</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}<br><br>function&#xA0;</span><span style="color: #0000BB">reverse_complete</span><span style="color: #007700">(</span><span style="color: #0000BB">$task</span><span style="color: #007700">)<br>{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;COMPLETE:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$task</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">unique</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;,&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$task</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">data</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">#&#xA0;The&#xA0;worker&#xA0;script<br><br></span><span style="color: #007700">echo&#xA0;</span><span style="color: #DD0000">&quot;Starting\n&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">#&#xA0;Create&#xA0;our&#xA0;worker&#xA0;object.<br></span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">GearmanWorker</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;Add&#xA0;default&#xA0;server&#xA0;(localhost).<br></span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addServer</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">#&#xA0;Register&#xA0;function&#xA0;&quot;reverse&quot;&#xA0;with&#xA0;the&#xA0;server.<br></span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">addFunction</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;reverse&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;reverse_fn&quot;</span><span style="color: #007700">);<br><br>print&#xA0;</span><span style="color: #DD0000">&quot;Waiting&#xA0;for&#xA0;job...\n&quot;</span><span style="color: #007700">;<br>while(</span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">work</span><span style="color: #007700">())<br>{<br>&#xA0;&#xA0;if&#xA0;(</span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">returnCode</span><span style="color: #007700">()&#xA0;!=&#xA0;</span><span style="color: #0000BB">GEARMAN_SUCCESS</span><span style="color: #007700">)<br>&#xA0;&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;return_code:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$gmworker</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">returnCode</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;break;<br>&#xA0;&#xA0;}<br>}<br><br>function&#xA0;</span><span style="color: #0000BB">reverse_fn</span><span style="color: #007700">(</span><span style="color: #0000BB">$job</span><span style="color: #007700">)<br>{<br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Received&#xA0;job:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">handle</span><span style="color: #007700">()&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;</span><span style="color: #0000BB">$workload&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">workload</span><span style="color: #007700">();<br>&#xA0;&#xA0;</span><span style="color: #0000BB">$workload_size&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">workloadSize</span><span style="color: #007700">();<br><br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Workload:&#xA0;</span><span style="color: #0000BB">$workload</span><span style="color: #DD0000">&#xA0;(</span><span style="color: #0000BB">$workload_size</span><span style="color: #DD0000">)\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;</span><span style="color: #FF8000">#&#xA0;This&#xA0;status&#xA0;loop&#xA0;is&#xA0;not&#xA0;needed,&#xA0;just&#xA0;showing&#xA0;how&#xA0;it&#xA0;works<br>&#xA0;&#xA0;</span><span style="color: #007700">for&#xA0;(</span><span style="color: #0000BB">$x</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&#xA0;</span><span style="color: #0000BB">$x&#xA0;</span><span style="color: #007700">&lt;&#xA0;</span><span style="color: #0000BB">$workload_size</span><span style="color: #007700">;&#xA0;</span><span style="color: #0000BB">$x</span><span style="color: #007700">++)<br>&#xA0;&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Sending&#xA0;status:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;(</span><span style="color: #0000BB">$x&#xA0;</span><span style="color: #007700">+&#xA0;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;/</span><span style="color: #0000BB">$workload_size</span><span style="color: #DD0000">&#xA0;complete\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sendStatus</span><span style="color: #007700">(</span><span style="color: #0000BB">$x</span><span style="color: #007700">+</span><span style="color: #0000BB">1</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$workload_size</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$job</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">sendData</span><span style="color: #007700">(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$workload</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$x</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">1</span><span style="color: #007700">));<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">sleep</span><span style="color: #007700">(</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br>&#xA0;&#xA0;}<br><br>&#xA0;&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">strrev</span><span style="color: #007700">(</span><span style="color: #0000BB">$workload</span><span style="color: #007700">);<br>&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Result:&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #DD0000">\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;</span><span style="color: #FF8000">#&#xA0;Return&#xA0;what&#xA0;we&#xA0;want&#xA0;to&#xA0;send&#xA0;back&#xA0;to&#xA0;the&#xA0;client.<br>&#xA0;&#xA0;</span><span style="color: #007700">return&#xA0;</span><span style="color: #0000BB">$result</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>
     Worker output for two workers running:
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Received job: H:foo.local:65
Workload: !dlroW olleH (12)
1/12 complete
Received job: H:foo.local:66
Workload: Hello World! (12)
Sending status: 1/12 complete
Sending status: 2/12 complete
Sending status: 2/12 complete
Sending status: 3/12 complete
Sending status: 3/12 complete
Sending status: 4/12 complete
Sending status: 4/12 complete
Sending status: 5/12 complete
Sending status: 5/12 complete
Sending status: 6/12 complete
Sending status: 6/12 complete
Sending status: 7/12 complete
Sending status: 7/12 complete
Sending status: 8/12 complete
Sending status: 8/12 complete
Sending status: 9/12 complete
Sending status: 9/12 complete
Sending status: 10/12 complete
Sending status: 10/12 complete
Sending status: 11/12 complete
Sending status: 11/12 complete
Sending status: 12/12 complete
Sending status: 12/12 complete
Result: !dlroW olleH
Result: Hello World!
</pre></div>
    </div>
    <div class="example-contents"><p>
     Client output:
    </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
STATUS: 1, H:foo.local:66 - 1/12
STATUS: 1, H:foo.local:66 - 2/12
STATUS: 1, H:foo.local:66 - 3/12
STATUS: 1, H:foo.local:66 - 4/12
STATUS: 1, H:foo.local:66 - 5/12
STATUS: 1, H:foo.local:66 - 6/12
STATUS: 1, H:foo.local:66 - 7/12
STATUS: 1, H:foo.local:66 - 8/12
STATUS: 1, H:foo.local:66 - 9/12
STATUS: 1, H:foo.local:66 - 10/12
STATUS: 1, H:foo.local:66 - 11/12
STATUS: 1, H:foo.local:66 - 12/12
COMPLETE: 1, !dlroW olleH
DONE
</pre></div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-gearmanclient.addtaskbackground-seealso">
  <h3 class="title">See Also</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="gearmanclient.addtask.html" class="methodname" rel="rdfs-seeAlso">GearmanClient::addTask()</a> - Add a task to be run in parallel</span></li>
    <li class="member"><span class="methodname"><a href="gearmanclient.addtaskhigh.html" class="methodname" rel="rdfs-seeAlso">GearmanClient::addTaskHigh()</a> - Add a high priority task to run in parallel</span></li>
    <li class="member"><span class="methodname"><a href="gearmanclient.addtasklow.html" class="methodname" rel="rdfs-seeAlso">GearmanClient::addTaskLow()</a> - Add a low priority task to run in parallel</span></li>
    <li class="member"><span class="methodname"><a href="gearmanclient.addtaskhighbackground.html" class="methodname" rel="rdfs-seeAlso">GearmanClient::addTaskHighBackground()</a> - Add a high priority background task to be run in parallel</span></li>
    <li class="member"><span class="methodname"><a href="gearmanclient.addtasklowbackground.html" class="methodname" rel="rdfs-seeAlso">GearmanClient::addTaskLowBackground()</a> - Add a low priority background task to be run in parallel</span></li>
    <li class="member"><span class="methodname"><a href="gearmanclient.runtasks.html" class="methodname" rel="rdfs-seeAlso">GearmanClient::runTasks()</a> - Run a list of tasks in parallel</span></li>
   </ul>
  </p>
 </div>


