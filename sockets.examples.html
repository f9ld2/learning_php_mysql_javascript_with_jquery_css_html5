---
layout: default
---

 <h1>Examples</h1>

 <p class="para">
  <div class="example" id="example-5143">
   <p><strong>Example #1 Socket example: Simple TCP/IP server</strong></p>
   <div class="example-contents"><p>
    This example shows a simple talkback server. Change the
    <var class="varname"><var class="varname">address</var></var> and <var class="varname"><var class="varname">port</var></var> variables
    to suit your setup and execute. You may then connect to the
    server with a command similar to: <strong class="command">telnet 192.168.1.53
    10000</strong> (where the address and port match your
    setup). Anything you type will then be output on the server
    side, and echoed back to you. To disconnect, enter &apos;quit&apos;.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
#!/usr/local/bin/php&#xA0;-q<br><span style="color: #0000BB">&lt;?php<br>error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*&#xA0;Allow&#xA0;the&#xA0;script&#xA0;to&#xA0;hang&#xA0;around&#xA0;waiting&#xA0;for&#xA0;connections.&#xA0;*/<br></span><span style="color: #0000BB">set_time_limit</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*&#xA0;Turn&#xA0;on&#xA0;implicit&#xA0;output&#xA0;flushing&#xA0;so&#xA0;we&#xA0;see&#xA0;what&#xA0;we&apos;re&#xA0;getting<br>&#xA0;*&#xA0;as&#xA0;it&#xA0;comes&#xA0;in.&#xA0;*/<br></span><span style="color: #0000BB">ob_implicit_flush</span><span style="color: #007700">();<br><br></span><span style="color: #0000BB">$address&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&apos;192.168.1.53&apos;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$port&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">10000</span><span style="color: #007700">;<br><br>if&#xA0;((</span><span style="color: #0000BB">$sock&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_create</span><span style="color: #007700">(</span><span style="color: #0000BB">AF_INET</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">SOCK_STREAM</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">SOL_TCP</span><span style="color: #007700">))&#xA0;===&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_create()&#xA0;failed:&#xA0;reason:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">())&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}<br><br>if&#xA0;(</span><span style="color: #0000BB">socket_bind</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$address</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$port</span><span style="color: #007700">)&#xA0;===&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_bind()&#xA0;failed:&#xA0;reason:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">))&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}<br><br>if&#xA0;(</span><span style="color: #0000BB">socket_listen</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">5</span><span style="color: #007700">)&#xA0;===&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_listen()&#xA0;failed:&#xA0;reason:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">))&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}<br><br>do&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;((</span><span style="color: #0000BB">$msgsock&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_accept</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">))&#xA0;===&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_accept()&#xA0;failed:&#xA0;reason:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">))&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;break;<br>&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;Send&#xA0;instructions.&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$msg&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;\nWelcome&#xA0;to&#xA0;the&#xA0;PHP&#xA0;Test&#xA0;Server.&#xA0;\n&quot;&#xA0;</span><span style="color: #007700">.<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;To&#xA0;quit,&#xA0;type&#xA0;&apos;quit&apos;.&#xA0;To&#xA0;shut&#xA0;down&#xA0;the&#xA0;server&#xA0;type&#xA0;&apos;shutdown&apos;.\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">socket_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$msgsock</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$msg</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$msg</span><span style="color: #007700">));<br><br>&#xA0;&#xA0;&#xA0;&#xA0;do&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(</span><span style="color: #0000BB">false&#xA0;</span><span style="color: #007700">===&#xA0;(</span><span style="color: #0000BB">$buf&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_read</span><span style="color: #007700">(</span><span style="color: #0000BB">$msgsock</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">2048</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">PHP_NORMAL_READ</span><span style="color: #007700">)))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_read()&#xA0;failed:&#xA0;reason:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$msgsock</span><span style="color: #007700">))&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;break&#xA0;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(!</span><span style="color: #0000BB">$buf&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">trim</span><span style="color: #007700">(</span><span style="color: #0000BB">$buf</span><span style="color: #007700">))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;continue;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(</span><span style="color: #0000BB">$buf&#xA0;</span><span style="color: #007700">==&#xA0;</span><span style="color: #DD0000">&apos;quit&apos;</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;break;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(</span><span style="color: #0000BB">$buf&#xA0;</span><span style="color: #007700">==&#xA0;</span><span style="color: #DD0000">&apos;shutdown&apos;</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$msgsock</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;break&#xA0;</span><span style="color: #0000BB">2</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$talkback&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;PHP:&#xA0;You&#xA0;said&#xA0;&apos;</span><span style="color: #0000BB">$buf</span><span style="color: #DD0000">&apos;.\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">socket_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$msgsock</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$talkback</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$talkback</span><span style="color: #007700">));<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;</span><span style="color: #0000BB">$buf</span><span style="color: #DD0000">\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;}&#xA0;while&#xA0;(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$msgsock</span><span style="color: #007700">);<br>}&#xA0;while&#xA0;(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$sock</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <p class="para">
  <div class="example" id="snmp.close.example.basic">
   <p><strong>Example #2 Socket example: Simple TCP/IP client</strong></p>
   <div class="example-contents"><p>
    This example shows a simple, one-shot HTTP client. It simply
    connects to a page, submits a HEAD request, echoes the reply,
    and exits.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ALL</span><span style="color: #007700">);<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;&lt;h2&gt;TCP/IP&#xA0;Connection&lt;/h2&gt;\n&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/*&#xA0;Get&#xA0;the&#xA0;port&#xA0;for&#xA0;the&#xA0;WWW&#xA0;service.&#xA0;*/<br></span><span style="color: #0000BB">$service_port&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">getservbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;www&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;tcp&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*&#xA0;Get&#xA0;the&#xA0;IP&#xA0;address&#xA0;for&#xA0;the&#xA0;target&#xA0;host.&#xA0;*/<br></span><span style="color: #0000BB">$address&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">gethostbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;www.example.com&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">/*&#xA0;Create&#xA0;a&#xA0;TCP/IP&#xA0;socket.&#xA0;*/<br></span><span style="color: #0000BB">$socket&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_create</span><span style="color: #007700">(</span><span style="color: #0000BB">AF_INET</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">SOCK_STREAM</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">SOL_TCP</span><span style="color: #007700">);<br>if&#xA0;(</span><span style="color: #0000BB">$socket&#xA0;</span><span style="color: #007700">===&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_create()&#xA0;failed:&#xA0;reason:&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">())&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;OK.\n&quot;</span><span style="color: #007700">;<br>}<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;Attempting&#xA0;to&#xA0;connect&#xA0;to&#xA0;&apos;</span><span style="color: #0000BB">$address</span><span style="color: #DD0000">&apos;&#xA0;on&#xA0;port&#xA0;&apos;</span><span style="color: #0000BB">$service_port</span><span style="color: #DD0000">&apos;...&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$result&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$address</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$service_port</span><span style="color: #007700">);<br>if&#xA0;(</span><span style="color: #0000BB">$result&#xA0;</span><span style="color: #007700">===&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_connect()&#xA0;failed.\nReason:&#xA0;(</span><span style="color: #0000BB">$result</span><span style="color: #DD0000">)&#xA0;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">))&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;OK.\n&quot;</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">$in&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;HEAD&#xA0;/&#xA0;HTTP/1.1\r\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$in&#xA0;</span><span style="color: #007700">.=&#xA0;</span><span style="color: #DD0000">&quot;Host:&#xA0;www.example.com\r\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$in&#xA0;</span><span style="color: #007700">.=&#xA0;</span><span style="color: #DD0000">&quot;Connection:&#xA0;Close\r\n\r\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$out&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&apos;&apos;</span><span style="color: #007700">;<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;Sending&#xA0;HTTP&#xA0;HEAD&#xA0;request...&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">socket_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$in</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$in</span><span style="color: #007700">));<br>echo&#xA0;</span><span style="color: #DD0000">&quot;OK.\n&quot;</span><span style="color: #007700">;<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;Reading&#xA0;response:\n\n&quot;</span><span style="color: #007700">;<br>while&#xA0;(</span><span style="color: #0000BB">$out&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_read</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">2048</span><span style="color: #007700">))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #0000BB">$out</span><span style="color: #007700">;<br>}<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;Closing&#xA0;socket...&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">);<br>echo&#xA0;</span><span style="color: #DD0000">&quot;OK.\n\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
