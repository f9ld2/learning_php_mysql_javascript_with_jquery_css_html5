---
layout: default
---

 <div class="refnamediv">
  <h1 class="refname">MongoCollection::group</h1>
  <p class="verinfo">(PECL mongo &gt;=0.9.2)</p><p class="refpurpose"><span class="refname">MongoCollection::group</span> &#x2014; <span class="dc-title">Performs an operation similar to SQL&apos;s GROUP BY command</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mongocollection.group-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><strong>MongoCollection::group</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$keys</code></span>
   , <span class="methodparam"><span class="type">array</span> <code class="parameter">$initial</code></span>
   , <span class="methodparam"><span class="type"><a href="class.mongocode.html" class="type MongoCode">MongoCode</a></span> <code class="parameter">$reduce</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code><span class="initializer"> = array()</span></span>
  ] )</div>

 </div>


 <div class="refsect1 parameters" id="refsect1-mongocollection.group-parameters">
  <h3 class="title">Parameters</h3>  
  <p class="para">
   <dl>

    
     <dt>

      <code class="parameter">keys</code>
     </dt>

     <dd>

      <p class="para">
       Fields to group by.  If an array or non-code object is passed, it will be
       the key used to group results. 
      </p>
      <p class="para">1.0.4+: If <code class="parameter">keys</code> is an instance of 
       <a href="class.mongocode.html" class="classname">MongoCode</a>, <code class="parameter">keys</code> will be treated as
       a function that returns the key to group by (see the &quot;Passing a 
       <code class="parameter">keys</code> function&quot; example below).  
      </p>
     </dd>

       
    
     <dt>

      <code class="parameter">initial</code>
     </dt>

     <dd>

      <p class="para">
       Initial value of the aggregation counter object.
      </p>
     </dd>

       
    
     <dt>

      <code class="parameter">reduce</code>
     </dt>

     <dd>

      <p class="para">
       A function that takes two arguments (the current document and the 
       aggregation to this point) and does the aggregation.
      </p>
     </dd>

       
    
     <dt>

      <code class="parameter">options</code>
     </dt>

     <dd>

      <p class="para">
       Optional parameters to the group command.  Valid options include:
      </p>
      <ul class="itemizedlist">
       <li class="listitem">
        <p class="para">
         <em>&quot;condition&quot;</em>
        </p>
        <p class="para">
         Criteria for including a document in the aggregation.
        </p>
       </li>
       <li class="listitem">
        <p class="para">
         <em>&quot;finalize&quot;</em>
        </p>
        <p class="para">
         Function called once per unique key that takes the final output of the
         reduce function.
        </p>
       </li>
       <li class="listitem"><p class="para"><em>&quot;maxTimeMS&quot;</em></p><p class="para">Specifies a cumulative time limit in milliseconds for processing the operation on the server (does not include idle time). If the operation is not completed by the server within the timeout period, a <a href="class.mongoexecutiontimeoutexception.html" class="classname">MongoExecutionTimeoutException</a> will be thrown.</p></li>
      </ul>
     </dd>

       
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mongocollection.group-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns an array containing the result.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-mongocollection.group-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>1.5.0</td>
       <td>Added <em>&quot;maxTimeMS&quot;</em> option.</td>
      </tr>

      <tr>
       <td>1.2.11</td>
       <td>
        Emits <strong><code>E_DEPRECATED</code></strong> when
        <code class="parameter">options</code> is <span class="type"><span class="type scalar">scalar</span></span>.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mongocollection.group-examples">
  <h3 class="title">Examples</h3>
  <div class="example" id="example-1564">
   <p><strong>Example #1 <span class="function"><strong>MongoCollection::group()</strong></span> example</strong></p>
   <div class="example-contents"><p>
    This groups documents by category and creates a list of names within that
    category.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;category&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;fruit&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;apple&quot;</span><span style="color: #007700">));<br></span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;category&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;fruit&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;peach&quot;</span><span style="color: #007700">));<br></span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;category&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;fruit&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;banana&quot;</span><span style="color: #007700">));<br></span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;category&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;veggie&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;corn&quot;</span><span style="color: #007700">));<br></span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">insert</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;category&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;veggie&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;broccoli&quot;</span><span style="color: #007700">));<br><br></span><span style="color: #0000BB">$keys&#xA0;</span><span style="color: #007700">=&#xA0;array(</span><span style="color: #DD0000">&quot;category&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$initial&#xA0;</span><span style="color: #007700">=&#xA0;array(</span><span style="color: #DD0000">&quot;items&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array());<br><br></span><span style="color: #0000BB">$reduce&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;function&#xA0;(obj,&#xA0;prev)&#xA0;{&#xA0;prev.items.push(obj.name);&#xA0;}&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$g&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(</span><span style="color: #0000BB">$keys</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$initial</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$reduce</span><span style="color: #007700">);<br><br>echo&#xA0;</span><span style="color: #0000BB">json_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$g</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;retval&apos;</span><span style="color: #007700">]);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>The above example will output
something similar to:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
[{&quot;category&quot;:&quot;fruit&quot;,&quot;items&quot;:[&quot;apple&quot;,&quot;peach&quot;,&quot;banana&quot;]},{&quot;category&quot;:&quot;veggie&quot;,&quot;items&quot;:[&quot;corn&quot;,&quot;broccoli&quot;]}]
</pre></div>
   </div>
  </div>

  <div class="example" id="example-1565">
   <p><strong>Example #2 <span class="function"><strong>MongoCollection::group()</strong></span> example</strong></p>
   <div class="example-contents"><p>
    This example doesn&apos;t use any key, so every document will be its own group.
    It also uses a condition: only documents that match this condition will be
    processed by the grouping function.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;a&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">2</span><span style="color: #007700">));<br></span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;b&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">5</span><span style="color: #007700">));<br></span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&quot;a&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">1</span><span style="color: #007700">));<br><br></span><span style="color: #FF8000">//&#xA0;use&#xA0;all&#xA0;fields<br></span><span style="color: #0000BB">$keys&#xA0;</span><span style="color: #007700">=&#xA0;array();<br><br></span><span style="color: #FF8000">//&#xA0;set&#xA0;intial&#xA0;values<br></span><span style="color: #0000BB">$initial&#xA0;</span><span style="color: #007700">=&#xA0;array(</span><span style="color: #DD0000">&quot;count&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;JavaScript&#xA0;function&#xA0;to&#xA0;perform<br></span><span style="color: #0000BB">$reduce&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;function&#xA0;(obj,&#xA0;prev)&#xA0;{&#xA0;prev.count++;&#xA0;}&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&#xA0;only&#xA0;use&#xA0;documents&#xA0;where&#xA0;the&#xA0;&quot;a&quot;&#xA0;field&#xA0;is&#xA0;greater&#xA0;than&#xA0;1<br></span><span style="color: #0000BB">$condition&#xA0;</span><span style="color: #007700">=&#xA0;array(</span><span style="color: #DD0000">&apos;condition&apos;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(</span><span style="color: #DD0000">&quot;a&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(&#xA0;</span><span style="color: #DD0000">&apos;$gt&apos;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">1</span><span style="color: #007700">)));<br><br></span><span style="color: #0000BB">$g&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$collection</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(</span><span style="color: #0000BB">$keys</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$initial</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$reduce</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$condition</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$g</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>The above example will output
something similar to:</p></div>
   <div class="example-contents screen">
<div class="cdata"><pre>
array(4) {
  [&quot;retval&quot;]=&gt;
  array(1) {
    [0]=&gt;
    array(1) {
      [&quot;count&quot;]=&gt;
      float(1)
    }
  }
  [&quot;count&quot;]=&gt;
  float(1)
  [&quot;keys&quot;]=&gt;
  int(1)
  [&quot;ok&quot;]=&gt;
  float(1)
}
</pre></div>
   </div>
  </div>

  <div class="example" id="example-1566">
   <p><strong>Example #3 Passing a <code class="parameter">keys</code> function</strong></p>
   <div class="example-contents"><p>
    If you want to group by something other than a field name, you can pass
    a function as the first parameter of 
    <span class="function"><strong>MongoCollection::group()</strong></span> and it will be run against each
    document.  The return value of the function will be used as its grouping 
    value.
   </p></div>
   <div class="example-contents"><p>
    This example demonstrates grouping by the num field modulo 4.
   </p></div>

   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$c</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">group</span><span style="color: #007700">(new&#xA0;</span><span style="color: #0000BB">MongoCode</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;function(doc)&#xA0;{&#xA0;return&#xA0;{mod&#xA0;:&#xA0;doc.num&#xA0;%&#xA0;4};&#xA0;}&apos;</span><span style="color: #007700">),<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;array(</span><span style="color: #DD0000">&quot;count&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">),<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;new&#xA0;</span><span style="color: #0000BB">MongoCode</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;function(current,&#xA0;total)&#xA0;{&#xA0;total.count++;&#xA0;}&apos;</span><span style="color: #007700">));<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>


