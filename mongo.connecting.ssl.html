---
layout: default
---

  <h2 class="title">Connecting over SSL</h2>
  <p class="para">
   The driver supports connecting to <a href="https://docs.mongodb.com/manual/tutorial/configure-ssl/" class="link external">&#xBB;&#xA0;MongoDB over SSL</a>
   and can optionally use <a href="context.ssl.html" class="link">SSL Stream Context</a> options to provide more details,
   such as verifying certificates against specific certificate chain, or authenticate to
   <a href="https://docs.mongodb.com/manual/tutorial/configure-x509/" class="link external">&#xBB;&#xA0;MongoDB using X509 certificates</a>.
  </p>

  <div class="example" id="mongo.tutorial.insert.multiple-example">
   <p><strong>Example #1 Connect to MongoDB Instance with SSL Encryption</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$mc&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;mongodb://server1&quot;</span><span style="color: #007700">,&#xA0;array(</span><span style="color: #DD0000">&quot;ssl&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">));<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <div class="example" id="mongo.tutorial.counting-example">
   <p><strong>Example #2 Connect to MongoDB Instance with SSL Encryption, verifying it is who we think it is</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$SSL_DIR&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;/vagrant/certs&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$SSL_FILE&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;CA_Root_Certificate.pem&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$ctx&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">stream_context_create</span><span style="color: #007700">(array(<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;ssl&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;Certificate&#xA0;Authority&#xA0;the&#xA0;remote&#xA0;server&#xA0;certificate&#xA0;must&#xA0;be&#xA0;signed&#xA0;by&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;cafile&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$SSL_DIR&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #DD0000">&quot;/&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$SSL_FILE</span><span style="color: #007700">,<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;Disable&#xA0;self&#xA0;signed&#xA0;certificates&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;allow_self_signed&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;Verify&#xA0;the&#xA0;peer&#xA0;certificate&#xA0;against&#xA0;our&#xA0;provided&#xA0;Certificate&#xA0;Authority&#xA0;root&#xA0;certificate&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;verify_peer&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">,&#xA0;</span><span style="color: #FF8000">/*&#xA0;Default&#xA0;to&#xA0;false&#xA0;pre&#xA0;PHP&#xA0;5.6&#xA0;*/<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;/*&#xA0;Verify&#xA0;the&#xA0;peer&#xA0;name&#xA0;(e.g.&#xA0;hostname&#xA0;validation)&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;/*&#xA0;Will&#xA0;use&#xA0;the&#xA0;hostname&#xA0;used&#xA0;to&#xA0;connec&#xA0;to&#xA0;the&#xA0;node&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;verify_peer_name&quot;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;Verify&#xA0;the&#xA0;server&#xA0;certificate&#xA0;has&#xA0;not&#xA0;expired&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;verify_expiry&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">,&#xA0;</span><span style="color: #FF8000">/*&#xA0;Only&#xA0;available&#xA0;in&#xA0;the&#xA0;MongoDB&#xA0;PHP&#xA0;Driver&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">),<br>);<br><br></span><span style="color: #0000BB">$mc&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;mongodb://server1&quot;</span><span style="color: #007700">,&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;array(</span><span style="color: #DD0000">&quot;ssl&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">),&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;array(</span><span style="color: #DD0000">&quot;context&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$ctx</span><span style="color: #007700">)<br>);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <blockquote class="note"><p><strong class="note">Note</strong>: 
    </p><p class="para">
     The <em>&quot;verify_peer_name&quot;</em> is new in PHP 5.6.0. The
     MongoDB driver as of 1.6.5 however has backported this feature into the
     driver itself, so it works with PHP 5.3 and 5.4 too
    </p>
   <p></p></blockquote>
  </div>


  <div class="example" id="mongo.tutorial.cursor-example">
   <p><strong>Example #3 Connect to MongoDB Instance that Requires Client Certificates</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$SSL_DIR&#xA0;&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;/vagrant/certs&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$SSL_FILE&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;CA_Root_Certificate.pem&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$MYCERT&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;/vagrant/certs/ca-signed-client.pem&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$ctx&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">stream_context_create</span><span style="color: #007700">(array(<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;ssl&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;local_cert&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$MYCERT</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;If&#xA0;the&#xA0;certificate&#xA0;we&#xA0;are&#xA0;providing&#xA0;was&#xA0;passphrase&#xA0;encoded,&#xA0;we&#xA0;need&#xA0;to&#xA0;set&#xA0;it&#xA0;here&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;passphrase&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;My&#xA0;Passphrase&#xA0;for&#xA0;the&#xA0;local_cert&quot;</span><span style="color: #007700">,<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">/*&#xA0;Optionally&#xA0;verify&#xA0;the&#xA0;server&#xA0;is&#xA0;who&#xA0;he&#xA0;says&#xA0;he&#xA0;is&#xA0;*/<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;cafile&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$SSL_DIR&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #DD0000">&quot;/&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$SSL_FILE</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;allow_self_signed&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;verify_peer&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;verify_peer_name&quot;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;verify_expiry&quot;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;),<br>));<br><br></span><span style="color: #0000BB">$mc&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;mongodb://server1/?ssl=true&quot;</span><span style="color: #007700">,&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;array(),&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;array(</span><span style="color: #DD0000">&quot;context&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$ctx</span><span style="color: #007700">)<br>);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>

  <div class="example" id="mongo.tutorial.criteria-example">
   <p><strong>Example #4 Authenticating with X.509 certificates</strong></p>
   <div class="example-contents"><p>
    The username is the <em>certificate subject</em> from the X509, which can be extracted like this:
   </p></div>
   <div class="example-contents">
<div class="shellcode"><pre class="shellcode">openssl x509 -in /vagrant/certs/ca-signed-client.pem -inform PEM -subject -nameopt RFC2253</pre>
</div>
   </div>

   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$ctx&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">stream_context_create</span><span style="color: #007700">(&#xA0;array(<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;ssl&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;local_cert&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;/vagrant/certs/ca-signed-client.pem&quot;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;&#xA0;)<br>)&#xA0;);<br><br></span><span style="color: #0000BB">$mc&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">MongoClient</span><span style="color: #007700">(<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&apos;mongodb://username@server1/?authSource=$external&amp;authMechanism=MONGODB-X509&amp;ssl=true&apos;</span><span style="color: #007700">,&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;array(),&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;array(</span><span style="color: #DD0000">&quot;context&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$ctx</span><span style="color: #007700">)<br>);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>
    Where <em>username</em> is the certificate subject.
   </p></div>
  </div>

  <div class="simplesect">
   <h3 class="title">Changelog</h3>
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>1.5.0</td>
       <td>
        Added support for X509 authentication.
       </td>
      </tr>

      <tr>
       <td>1.4.0</td>
       <td>
        Added support for connecting to SSL enabled MongoDB.
       </td>
      </tr>

     </tbody>
    
   </table>

  </div>

 