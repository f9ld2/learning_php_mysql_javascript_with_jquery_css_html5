---
layout: default
---

 <div class="refnamediv">
  <h1 class="refname">MongoDB::execute</h1>
  <p class="verinfo">(PECL mongo &gt;=0.9.3)</p><p class="refpurpose"><span class="refname">MongoDB::execute</span> &#x2014; <span class="dc-title">Runs JavaScript code on the database server [deprecated]</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-mongodb.execute-description">
  <h3 class="title">Description</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><strong>MongoDB::execute</strong></span>
    ( <span class="methodparam"><span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <code class="parameter">$code</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$args</code><span class="initializer"> = array()</span></span>
  ] )</div>

  <div class="warning"><strong class="warning">Warning</strong>
   <p class="para">
    The <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&#xBB;&#xA0;eval</a> command,
    which this method invokes, is deprecated in MongoDB 3.0+.
   </p>
  </div>
  <p class="para">
   The Mongo database server runs a JavaScript engine.  This method allows you
   to run arbitary JavaScript on the database.  This can be useful if you want
   touch a number of collections lightly, or process some results on the
   database side to reduce the amount that has to be sent to the client.
  </p>
  <p class="para">
   Running JavaScript in the database takes a write lock, meaning it blocks 
   other operations.  Make sure you consider this before running a long script.
  </p>
  <p class="para">
   This is a wrapper for the
   <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&#xBB;&#xA0;eval</a> database
   command. This method is basically:
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #007700">public&#xA0;function&#xA0;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$code</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$args</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">command</span><span style="color: #007700">(array(</span><span style="color: #DD0000">&apos;eval&apos;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$code</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;args&apos;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">$args</span><span style="color: #007700">));<br>}<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </p>
  <p class="para">
   MongoDB implies a return statement if you have a single statement on a single
   line. This can cause some unintuitive behavior.  For example, this returns 
   &quot;foo&quot;:
  </p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;&quot;foo&quot;;&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <p class="para">
   However, these return <strong><code>NULL</code></strong>:
  </p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;&quot;bar&quot;;&#xA0;&quot;foo&quot;;&apos;</span><span style="color: #007700">);&#xA0;</span><span style="color: #FF8000">//&#xA0;more&#xA0;than&#xA0;one&#xA0;statement<br><br></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;db.foo.count(<br>);&apos;</span><span style="color: #007700">);&#xA0;</span><span style="color: #FF8000">//&#xA0;more&#xA0;than&#xA0;one&#xA0;line<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <p class="para">
   To avoid surprising behavior, it is best not to depend on MongoDB to decide 
   what to return, but to explicitly state a return value. In the examples 
   above, we can change them to:
  </p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;&quot;bar&quot;;&#xA0;return&#xA0;&quot;foo&quot;;&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;return&#xA0;db.foo.count(<br>);&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <p class="para">
   Now the first statement will return &quot;foo&quot; and the second statement will 
   return a count of the &quot;foo&quot; collection.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-mongodb.execute-parameters">
  <h3 class="title">Parameters</h3>
  <p class="para">
   <dl>

    
     <dt>

      <code class="parameter">code</code>
     </dt>

     <dd>

      <p class="para">
       <a href="class.mongocode.html" class="classname">MongoCode</a> or string to execute.
      </p>
     </dd>

       
    
     <dt>

      <code class="parameter">args</code>
     </dt>

     <dd>

      <p class="para">
       Arguments to be passed to <em>code</em>.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-mongodb.execute-returnvalues">
  <h3 class="title">Return Values</h3>
  <p class="para">
   Returns the result of the evaluation.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-mongodb.execute-examples">
  <h3 class="title">Examples</h3>
  <div class="example" id="example-1514">
   <p><strong>Example #1 Simple <span class="function"><strong>MongoDB::execute()</strong></span> example</strong></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$response&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;function()&#xA0;{&#xA0;return&#xA0;&apos;Hello,&#xA0;world!&apos;;&#xA0;}&quot;</span><span style="color: #007700">);<br>echo&#xA0;</span><span style="color: #0000BB">$response</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;retval&apos;</span><span style="color: #007700">];<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>The above example will output
something similar to:</p></div>
   <div class="example-contents screen"><br>
Hello, world!<br>
   </div>
  </div>
  <div class="example" id="example-1515">
   <p><strong>Example #2 Parameter <span class="function"><strong>MongoDB::execute()</strong></span> example</strong></p>
   <div class="example-contents"><p>
    The optional array of parameters will be passed to the JavaScript function.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$response&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;function(greeting,&#xA0;name)&#xA0;{&#xA0;return&#xA0;greeting+&apos;,&#xA0;&apos;+name+&apos;!&apos;;&#xA0;}&quot;</span><span style="color: #007700">,&#xA0;array(</span><span style="color: #DD0000">&quot;Good&#xA0;bye&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;Joe&quot;</span><span style="color: #007700">));<br>echo&#xA0;</span><span style="color: #0000BB">$response</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;retval&apos;</span><span style="color: #007700">];<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>The above example will output
something similar to:</p></div>
   <div class="example-contents screen"><br>
Good bye, Joe!<br>
   </div>
  </div>
  <div class="example" id="example-1516">
   <p><strong>Example #3 Scope example</strong></p>
   <div class="example-contents"><p>
    If a <a href="class.mongocode.html" class="classname">MongoCode</a> object is used instead of a string for
    the first parameter, a scope can be passed in which the JavaScript will be 
    executed.
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$func&#xA0;</span><span style="color: #007700">=&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;function(greeting,&#xA0;name)&#xA0;{&#xA0;&quot;</span><span style="color: #007700">.<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;return&#xA0;greeting+&apos;,&#xA0;&apos;+name+&apos;,&#xA0;says&#xA0;&apos;+greeter;&quot;</span><span style="color: #007700">.<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;}&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$scope&#xA0;</span><span style="color: #007700">=&#xA0;array(</span><span style="color: #DD0000">&quot;greeter&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;Fred&quot;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$code&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">MongoCode</span><span style="color: #007700">(</span><span style="color: #0000BB">$func</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$scope</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$response&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$db</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$code</span><span style="color: #007700">,&#xA0;array(</span><span style="color: #DD0000">&quot;Goodbye&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;Joe&quot;</span><span style="color: #007700">));<br>echo&#xA0;</span><span style="color: #0000BB">$response</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;retval&apos;</span><span style="color: #007700">];<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>The above example will output
something similar to:</p></div>
   <div class="example-contents screen"><br>
Goodbye, Joe, says Fred <br>
   </div>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-mongodb.execute-seealso">
  <h3 class="title">See Also</h3>
  <ul class="simplelist">
   <li class="member">The MongoDB <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&#xBB;&#xA0;eval command</a> docs</li>
  </ul>
 </div>


 <div class="refsect1 changelog" id="refsect1-mongodb.execute-changelog">
  <h3 class="title">Changelog</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Version</th>
       <th>Description</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
       <td>1.7.0</td>
       <td>
        This method has been deprecated as a result of the underlaying
        <a href="https://docs.mongodb.com/manual/reference/command/eval/" class="link external">&#xBB;&#xA0;eval</a> command
        being deprecated in MongoDB 3.0+.
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>

