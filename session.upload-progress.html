---
layout: default
---

 <h1>Session Upload Progress</h1>


 <p class="para">
  When the
  <a href="session.configuration.html#ini.session.upload-progress.enabled" class="link">session.upload_progress.enabled</a>
  INI option is enabled, PHP will be able to track the upload progress of
  individual files being uploaded.
  This information isn&apos;t particularly useful for the actual upload request
  itself, but during the file upload an application can send a POST request
  to a separate endpoint (via <acronym>XHR</acronym> for example) to check the
  status.
 </p>
 <p class="para">
  The upload progress will be available in the <var class="varname"><var class="varname"><a href="reserved.variables.session.html" class="classname">$_SESSION</a></var></var>
  superglobal when an upload is in progress, and when POSTing a variable of
  the same name as the
  <a href="session.configuration.html#ini.session.upload-progress.name" class="link">session.upload_progress.name</a>
  INI setting is set to.
  When PHP detects such POST requests, it will populate an array in the
  <var class="varname"><var class="varname"><a href="reserved.variables.session.html" class="classname">$_SESSION</a></var></var>, where the index is a concatenated value of the
  <a href="session.configuration.html#ini.session.upload-progress.prefix" class="link">session.upload_progress.prefix</a>
  and
  <a href="session.configuration.html#ini.session.upload-progress.name" class="link">session.upload_progress.name</a>
  INI options.
  The key is typically retrieved by reading these INI settings, i.e.
  <div class="informalexample">
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$key&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">ini_get</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;session.upload_progress.prefix&quot;</span><span style="color: #007700">)&#xA0;.&#xA0;</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #0000BB">ini_get</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;session.upload_progress.name&quot;</span><span style="color: #007700">)];<br></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$_SESSION</span><span style="color: #007700">[</span><span style="color: #0000BB">$key</span><span style="color: #007700">]);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <p class="para">
  It is also possible to <em class="emphasis">cancel</em> the currently in-progress file
  upload, by setting the <em>$_SESSION[$key][&quot;cancel_upload&quot;]</em> key to
  <strong><code>TRUE</code></strong>.
  When uploading multiple files in the same request, this will only cancel the
  currently in-progress file upload, and pending file uploads, but will not
  remove successfully completed uploads.
  When an upload is cancelled like this, the <em>error</em> key in
  <var class="varname"><var class="varname"><a href="reserved.variables.files.html" class="classname">$_FILES</a></var></var> array will be set to
  <strong><code>UPLOAD_ERR_EXTENSION</code></strong>.
 </p>
 <p class="para">
  The
  <a href="session.configuration.html#ini.session.upload-progress.freq" class="link">session.upload_progress.freq</a>
  and
  <a href="session.configuration.html#ini.session.upload-progress.min-freq" class="link">session.upload_progress.min_freq</a>
  INI options control how frequent the upload progress information should be
  recalculated.
  With a reasonable amount for these two settings, the overhead of this
  feature is almost non-existent.
 </p>
 <p class="para">
  <div class="example" id="example-5372">
   <p><strong>Example #1 Example information</strong></p>
   <div class="example-contents"><p>
    Example of the structure of the progress upload array.
   </p></div>
   <div class="example-contents">
<div class="htmlcode"><pre class="htmlcode">&lt;form action=&quot;upload.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;
 &lt;input type=&quot;hidden&quot; name=&quot;&lt;?php echo ini_get(&quot;session.upload_progress.name&quot;); ?&gt;&quot; value=&quot;123&quot; /&gt;
 &lt;input type=&quot;file&quot; name=&quot;file1&quot; /&gt;
 &lt;input type=&quot;file&quot; name=&quot;file2&quot; /&gt;
 &lt;input type=&quot;submit&quot; /&gt;
&lt;/form&gt;</pre>
</div>
   </div>

   <div class="example-contents"><p>
    The data stored in the session will look like this:
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$_SESSION</span><span style="color: #007700">[</span><span style="color: #DD0000">&quot;upload_progress_123&quot;</span><span style="color: #007700">]&#xA0;=&#xA0;array(<br>&#xA0;</span><span style="color: #DD0000">&quot;start_time&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">1234567890</span><span style="color: #007700">,&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;The&#xA0;request&#xA0;time<br>&#xA0;</span><span style="color: #DD0000">&quot;content_length&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">57343257</span><span style="color: #007700">,&#xA0;</span><span style="color: #FF8000">//&#xA0;POST&#xA0;content&#xA0;length<br>&#xA0;</span><span style="color: #DD0000">&quot;bytes_processed&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">453489</span><span style="color: #007700">,&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Amount&#xA0;of&#xA0;bytes&#xA0;received&#xA0;and&#xA0;processed<br>&#xA0;</span><span style="color: #DD0000">&quot;done&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;true&#xA0;when&#xA0;the&#xA0;POST&#xA0;handler&#xA0;has&#xA0;finished,&#xA0;successfully&#xA0;or&#xA0;not<br>&#xA0;</span><span style="color: #DD0000">&quot;files&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(<br>&#xA0;&#xA0;</span><span style="color: #0000BB">0&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;field_name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;file1&quot;</span><span style="color: #007700">,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Name&#xA0;of&#xA0;the&#xA0;&lt;input/&gt;&#xA0;field<br>&#xA0;&#xA0;&#xA0;//&#xA0;The&#xA0;following&#xA0;3&#xA0;elements&#xA0;equals&#xA0;those&#xA0;in&#xA0;$_FILES<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;foo.avi&quot;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;tmp_name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;/tmp/phpxxxxxx&quot;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;error&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;done&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">true</span><span style="color: #007700">,&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;True&#xA0;when&#xA0;the&#xA0;POST&#xA0;handler&#xA0;has&#xA0;finished&#xA0;handling&#xA0;this&#xA0;file<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;start_time&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">1234567890</span><span style="color: #007700">,&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;When&#xA0;this&#xA0;file&#xA0;has&#xA0;started&#xA0;to&#xA0;be&#xA0;processed<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;bytes_processed&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">57343250</span><span style="color: #007700">,&#xA0;</span><span style="color: #FF8000">//&#xA0;Number&#xA0;of&#xA0;bytes&#xA0;received&#xA0;and&#xA0;processed&#xA0;for&#xA0;this&#xA0;file<br>&#xA0;&#xA0;</span><span style="color: #007700">),<br>&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;An&#xA0;other&#xA0;file,&#xA0;not&#xA0;finished&#xA0;uploading,&#xA0;in&#xA0;the&#xA0;same&#xA0;request<br>&#xA0;&#xA0;</span><span style="color: #0000BB">1&#xA0;</span><span style="color: #007700">=&gt;&#xA0;array(<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;field_name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;file2&quot;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #DD0000">&quot;bar.avi&quot;</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;tmp_name&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;error&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;done&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;start_time&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">1234567899</span><span style="color: #007700">,<br>&#xA0;&#xA0;&#xA0;</span><span style="color: #DD0000">&quot;bytes_processed&quot;&#xA0;</span><span style="color: #007700">=&gt;&#xA0;</span><span style="color: #0000BB">54554</span><span style="color: #007700">,<br>&#xA0;&#xA0;),<br>&#xA0;)<br>);</span>
</span>
</code></div>
   </div>

  </div>
 </p>
 <div class="warning"><strong class="warning">Warning</strong>
  <p class="para">
   The web server&apos;s request buffering has to be disabled for this to work
   properly, else PHP may see the file upload only once fully uploaded. Servers
   such as Nginx are known to buffer larger requests.
  </p>
 </div>

