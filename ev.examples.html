---
layout: default
---

 <h1>Examples</h1>

 <div class="example" id="example-4157">
  <p><strong>Example #1 Simple timers</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&#xA0;Create&#xA0;and&#xA0;start&#xA0;timer&#xA0;firing&#xA0;after&#xA0;2&#xA0;seconds<br></span><span style="color: #0000BB">$w1&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvTimer</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&#xA0;function&#xA0;()&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;2&#xA0;seconds&#xA0;elapsed\n&quot;</span><span style="color: #007700">;<br>});<br><br></span><span style="color: #FF8000">//&#xA0;Create&#xA0;and&#xA0;launch&#xA0;timer&#xA0;firing&#xA0;after&#xA0;2&#xA0;seconds&#xA0;repeating&#xA0;each&#xA0;second<br>//&#xA0;until&#xA0;we&#xA0;manually&#xA0;stop&#xA0;it<br></span><span style="color: #0000BB">$w2&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvTimer</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">1</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;is&#xA0;called&#xA0;every&#xA0;second,&#xA0;is&#xA0;launched&#xA0;after&#xA0;2&#xA0;seconds\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;iteration&#xA0;=&#xA0;&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">iteration</span><span style="color: #007700">(),&#xA0;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Stop&#xA0;the&#xA0;watcher&#xA0;after&#xA0;5&#xA0;iterations<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">iteration</span><span style="color: #007700">()&#xA0;==&#xA0;</span><span style="color: #0000BB">5&#xA0;</span><span style="color: #007700">and&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Stop&#xA0;the&#xA0;watcher&#xA0;if&#xA0;further&#xA0;calls&#xA0;cause&#xA0;more&#xA0;than&#xA0;10&#xA0;iterations<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">iteration</span><span style="color: #007700">()&#xA0;&gt;=&#xA0;</span><span style="color: #0000BB">10&#xA0;</span><span style="color: #007700">and&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>});<br><br></span><span style="color: #FF8000">//&#xA0;Create&#xA0;stopped&#xA0;timer.&#xA0;It&#xA0;will&#xA0;be&#xA0;inactive&#xA0;until&#xA0;we&#xA0;start&#xA0;it&#xA0;ourselves<br></span><span style="color: #0000BB">$w_stopped&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">EvTimer</span><span style="color: #007700">::</span><span style="color: #0000BB">createStopped</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">5</span><span style="color: #007700">,&#xA0;function(</span><span style="color: #0000BB">$w</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;Callback&#xA0;of&#xA0;a&#xA0;timer&#xA0;created&#xA0;as&#xA0;stopped\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Stop&#xA0;the&#xA0;watcher&#xA0;after&#xA0;2&#xA0;iterations<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">iteration</span><span style="color: #007700">()&#xA0;&gt;=&#xA0;</span><span style="color: #0000BB">2&#xA0;</span><span style="color: #007700">and&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>});<br><br></span><span style="color: #FF8000">//&#xA0;Loop&#xA0;until&#xA0;Ev::stop()&#xA0;is&#xA0;called&#xA0;or&#xA0;all&#xA0;of&#xA0;watchers&#xA0;stop<br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br><br></span><span style="color: #FF8000">//&#xA0;Start&#xA0;and&#xA0;look&#xA0;if&#xA0;it&#xA0;works<br></span><span style="color: #0000BB">$w_stopped</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">start</span><span style="color: #007700">();<br>echo&#xA0;</span><span style="color: #DD0000">&quot;Run&#xA0;single&#xA0;iteration\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">RUN_ONCE</span><span style="color: #007700">);<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;Restart&#xA0;the&#xA0;second&#xA0;watcher&#xA0;and&#xA0;try&#xA0;to&#xA0;handle&#xA0;the&#xA0;same&#xA0;events,&#xA0;but&#xA0;don&apos;t&#xA0;block\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$w2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">again</span><span style="color: #007700">();<br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">RUN_NOWAIT</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvTimer</span><span style="color: #007700">(</span><span style="color: #0000BB">10</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&#xA0;function()&#xA0;{});<br>echo&#xA0;</span><span style="color: #DD0000">&quot;Running&#xA0;a&#xA0;blocking&#xA0;loop\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br>echo&#xA0;</span><span style="color: #DD0000">&quot;END\n&quot;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <div class="example-contents"><p>The above example will output
something similar to:</p></div>
  <div class="example-contents screen">
<div class="cdata"><pre>
2 seconds elapsed
is called every second, is launched after 2 seconds
iteration = 1
is called every second, is launched after 2 seconds
iteration = 2
is called every second, is launched after 2 seconds
iteration = 3
is called every second, is launched after 2 seconds
iteration = 4
is called every second, is launched after 2 seconds
iteration = 5
Run single iteration
Callback of a timer created as stopped
Restart the second watcher and try to handle the same events, but don&apos;t block
Running a blocking loop
is called every second, is launched after 2 seconds
iteration = 8
is called every second, is launched after 2 seconds
iteration = 9
is called every second, is launched after 2 seconds
iteration = 10
END
</pre></div>
  </div>
 </div>
 <div class="example" id="example-4158">
  <p><strong>Example #2 Periodic timer. Tick each 10.5 seconds</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvPeriodic</span><span style="color: #007700">(</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">10.5</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$revents</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #0000BB">time</span><span style="color: #007700">(),&#xA0;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br>});<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4159">
  <p><strong>Example #3 Periodic timer. Use reschedule callback</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&#xA0;Tick&#xA0;each&#xA0;10.5&#xA0;seconds<br><br></span><span style="color: #007700">function&#xA0;</span><span style="color: #0000BB">reschedule_cb&#xA0;</span><span style="color: #007700">(</span><span style="color: #0000BB">$watcher</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$now</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;return&#xA0;</span><span style="color: #0000BB">$now&#xA0;</span><span style="color: #007700">+&#xA0;(</span><span style="color: #0000BB">10.5</span><span style="color: #007700">.&#xA0;-&#xA0;</span><span style="color: #0000BB">fmod</span><span style="color: #007700">(</span><span style="color: #0000BB">$now</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">10.5</span><span style="color: #007700">));<br>}<br><br></span><span style="color: #0000BB">$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvPeriodic</span><span style="color: #007700">(</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;reschedule_cb&quot;</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$revents</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #0000BB">time</span><span style="color: #007700">(),&#xA0;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br>});<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4160">
  <p><strong>Example #4 Periodic timer. Tick every 10.5 seconds starting at now</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&#xA0;Tick&#xA0;every&#xA0;10.5&#xA0;seconds&#xA0;starting&#xA0;at&#xA0;now<br></span><span style="color: #0000BB">$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvPeriodic</span><span style="color: #007700">(</span><span style="color: #0000BB">fmod</span><span style="color: #007700">(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">now</span><span style="color: #007700">(),&#xA0;</span><span style="color: #0000BB">10.5</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">10.5</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$revents</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #0000BB">time</span><span style="color: #007700">(),&#xA0;</span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br>});<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4161">
  <p><strong>Example #5 Wait until STDIN is readable</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&#xA0;Wait&#xA0;until&#xA0;STDIN&#xA0;is&#xA0;readable<br></span><span style="color: #0000BB">$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvIo</span><span style="color: #007700">(</span><span style="color: #0000BB">STDIN</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">READ</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$watcher</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$revents</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;STDIN&#xA0;is&#xA0;readable\n&quot;</span><span style="color: #007700">;<br>});<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">RUN_ONCE</span><span style="color: #007700">);<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4162">
  <p><strong>Example #6 Use some async I/O to access a socket</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/*&#xA0;Use&#xA0;some&#xA0;async&#xA0;I/O&#xA0;to&#xA0;access&#xA0;a&#xA0;socket&#xA0;*/<br><br>//&#xA0;`sockets&apos;&#xA0;extension&#xA0;still&#xA0;logs&#xA0;warnings<br>//&#xA0;for&#xA0;EINPROGRESS,&#xA0;EAGAIN/EWOULDBLOCK&#xA0;etc.<br></span><span style="color: #0000BB">error_reporting</span><span style="color: #007700">(</span><span style="color: #0000BB">E_ERROR</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$e_nonblocking&#xA0;</span><span style="color: #007700">=&#xA0;array&#xA0;(</span><span style="color: #FF8000">/*EAGAIN&#xA0;or&#xA0;EWOULDBLOCK*/</span><span style="color: #0000BB">11</span><span style="color: #007700">,&#xA0;</span><span style="color: #FF8000">/*EINPROGRESS*/</span><span style="color: #0000BB">115</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Get&#xA0;the&#xA0;port&#xA0;for&#xA0;the&#xA0;WWW&#xA0;service<br></span><span style="color: #0000BB">$service_port&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">getservbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;www&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;tcp&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Get&#xA0;the&#xA0;IP&#xA0;address&#xA0;for&#xA0;the&#xA0;target&#xA0;host<br></span><span style="color: #0000BB">$address&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">gethostbyname</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;google.co.uk&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Create&#xA0;a&#xA0;TCP/IP&#xA0;socket<br></span><span style="color: #0000BB">$socket&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_create</span><span style="color: #007700">(</span><span style="color: #0000BB">AF_INET</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">SOCK_STREAM</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">SOL_TCP</span><span style="color: #007700">);<br>if&#xA0;(</span><span style="color: #0000BB">$socket&#xA0;</span><span style="color: #007700">===&#xA0;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;socket_create()&#xA0;failed:&#xA0;reason:&#xA0;&quot;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">.</span><span style="color: #0000BB">socket_strerror</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">())&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;\n&quot;</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #FF8000">//&#xA0;Set&#xA0;O_NONBLOCK&#xA0;flag<br></span><span style="color: #0000BB">socket_set_nonblock</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Abort&#xA0;on&#xA0;timeout<br></span><span style="color: #0000BB">$timeout_watcher&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvTimer</span><span style="color: #007700">(</span><span style="color: #0000BB">10.0</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&#xA0;function&#xA0;()&#xA0;use&#xA0;(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">stop</span><span style="color: #007700">(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">BREAK_ALL</span><span style="color: #007700">);<br>});<br><br></span><span style="color: #FF8000">//&#xA0;Make&#xA0;HEAD&#xA0;request&#xA0;when&#xA0;the&#xA0;socket&#xA0;is&#xA0;writable<br></span><span style="color: #0000BB">$write_watcher&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvIo</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">WRITE</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">)<br>&#xA0;&#xA0;&#xA0;&#xA0;use&#xA0;(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$timeout_watcher</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$e_nonblocking</span><span style="color: #007700">)<br>{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Stop&#xA0;timeout&#xA0;watcher<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$timeout_watcher</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Stop&#xA0;write&#xA0;watcher<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$in&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;HEAD&#xA0;/&#xA0;HTTP/1.1\r\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$in&#xA0;</span><span style="color: #007700">.=&#xA0;</span><span style="color: #DD0000">&quot;Host:&#xA0;google.co.uk\r\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$in&#xA0;</span><span style="color: #007700">.=&#xA0;</span><span style="color: #DD0000">&quot;Connection:&#xA0;Close\r\n\r\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(!</span><span style="color: #0000BB">socket_write</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$in</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$in</span><span style="color: #007700">)))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;Failed&#xA0;writing&#xA0;</span><span style="color: #0000BB">$in</span><span style="color: #DD0000">&#xA0;to&#xA0;socket&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;}<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$read_watcher&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvIo</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">READ</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$re</span><span style="color: #007700">)<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;use&#xA0;(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$e_nonblocking</span><span style="color: #007700">)<br>&#xA0;&#xA0;&#xA0;&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Socket&#xA0;is&#xA0;readable.&#xA0;recv()&#xA0;20&#xA0;bytes&#xA0;using&#xA0;non-blocking&#xA0;mode<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$ret&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_recv</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$out</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">20</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">MSG_DONTWAIT</span><span style="color: #007700">);<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(</span><span style="color: #0000BB">$ret</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #0000BB">$out</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}&#xA0;elseif&#xA0;(</span><span style="color: #0000BB">$ret&#xA0;</span><span style="color: #007700">===&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;All&#xA0;read<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Caught&#xA0;EINPROGRESS,&#xA0;EAGAIN,&#xA0;or&#xA0;EWOULDBLOCK<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">if&#xA0;(</span><span style="color: #0000BB">in_array</span><span style="color: #007700">(</span><span style="color: #0000BB">socket_last_error</span><span style="color: #007700">(),&#xA0;</span><span style="color: #0000BB">$e_nonblocking</span><span style="color: #007700">))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">socket_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;});<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br>});<br><br></span><span style="color: #0000BB">$result&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">socket_connect</span><span style="color: #007700">(</span><span style="color: #0000BB">$socket</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$address</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$service_port</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

  <div class="example-contents"><p>The above example will output
something similar to:</p></div>
  <div class="example-contents screen">
<div class="cdata"><pre>
HTTP/1.1 301 Moved Permanently
Location: http://www.google.co.uk/
Content-Type: text/html; charset=UTF-8
Date: Sun, 23 Dec 2012 16:08:27 GMT
Expires: Tue, 22 Jan 2013 16:08:27 GMT
Cache-Control: public, max-age=2592000
Server: gws
Content-Length: 221
X-XSS-Protection: 1; mode=block
X-Frame-Options: SAMEORIGIN
Connection: close


</pre></div>
  </div>
 </div>
 <div class="example" id="example-4163">
  <p><strong>Example #7 Embedding one loop into another</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/*<br>*&#xA0;Try&#xA0;to&#xA0;get&#xA0;an&#xA0;embeddable&#xA0;event&#xA0;loop&#xA0;and&#xA0;embed&#xA0;it&#xA0;into&#xA0;the&#xA0;default&#xA0;event&#xA0;loop.<br>*&#xA0;If&#xA0;it&#xA0;is&#xA0;impossible,&#xA0;use&#xA0;the&#xA0;default<br>*&#xA0;loop.&#xA0;The&#xA0;default&#xA0;loop&#xA0;is&#xA0;stored&#xA0;in&#xA0;$loop_hi,&#xA0;while&#xA0;the&#xA0;embeddable&#xA0;loop&#xA0;is<br>*&#xA0;stored&#xA0;in&#xA0;$loop_lo(which&#xA0;is&#xA0;$loop_hi&#xA0;in&#xA0;the&#xA0;case&#xA0;no&#xA0;embeddable&#xA0;loop&#xA0;can&#xA0;be<br>*&#xA0;used).<br>*<br>*&#xA0;Sample&#xA0;translated&#xA0;to&#xA0;PHP<br>*&#xA0;http://pod.tst.eu/http://cvs.schmorp.de/libev/ev.pod#Examples_CONTENT-9<br>*/<br></span><span style="color: #0000BB">$loop_hi&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">EvLoop</span><span style="color: #007700">::</span><span style="color: #0000BB">defaultLoop</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$loop_lo&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$embed&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">/*<br>*&#xA0;See&#xA0;if&#xA0;there&#xA0;is&#xA0;a&#xA0;chance&#xA0;of&#xA0;getting&#xA0;one&#xA0;that&#xA0;works<br>*&#xA0;(flags&apos;&#xA0;value&#xA0;of&#xA0;0&#xA0;means&#xA0;autodetection)<br>*/<br></span><span style="color: #0000BB">$loop_lo&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">embeddableBackends</span><span style="color: #007700">()&#xA0;&amp;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">recommendedBackends</span><span style="color: #007700">()<br>&#xA0;&#xA0;&#xA0;&#xA0;?&#xA0;new&#xA0;</span><span style="color: #0000BB">EvLoop</span><span style="color: #007700">(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">embeddableBackends</span><span style="color: #007700">()&#xA0;&amp;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">recommendedBackends</span><span style="color: #007700">())<br>&#xA0;&#xA0;&#xA0;&#xA0;:&#xA0;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br><br>if&#xA0;(</span><span style="color: #0000BB">$loop_lo</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$embed&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvEmbed</span><span style="color: #007700">(</span><span style="color: #0000BB">$loop_lo</span><span style="color: #007700">,&#xA0;function&#xA0;()&#xA0;{});<br>}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$loop_lo&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$loop_hi</span><span style="color: #007700">;<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4164">
  <p><strong>Example #8 Embedding loop created with kqueue backend into the default loop</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/*<br>*&#xA0;Check&#xA0;if&#xA0;kqueue&#xA0;is&#xA0;available&#xA0;but&#xA0;not&#xA0;recommended&#xA0;and&#xA0;create&#xA0;a&#xA0;kqueue&#xA0;backend<br>*&#xA0;for&#xA0;use&#xA0;with&#xA0;sockets&#xA0;(which&#xA0;usually&#xA0;work&#xA0;with&#xA0;any&#xA0;kqueue&#xA0;implementation).<br>*&#xA0;Store&#xA0;the&#xA0;kqueue/socket-only&#xA0;event&#xA0;loop&#xA0;in&#xA0;loop_socket.&#xA0;(One&#xA0;might&#xA0;optionally<br>*&#xA0;use&#xA0;EVFLAG_NOENV,&#xA0;too)<br>*<br>*&#xA0;Example&#xA0;borrowed&#xA0;from<br>*&#xA0;http://pod.tst.eu/http://cvs.schmorp.de/libev/ev.pod#Examples_CONTENT-9<br>*/<br></span><span style="color: #0000BB">$loop&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">EvLoop</span><span style="color: #007700">::</span><span style="color: #0000BB">defaultLoop</span><span style="color: #007700">();<br></span><span style="color: #0000BB">$socket_loop&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$embed&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">NULL</span><span style="color: #007700">;<br><br>if&#xA0;(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">supportedBackends</span><span style="color: #007700">()&#xA0;&amp;&#xA0;~</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">recommendedBackends</span><span style="color: #007700">()&#xA0;&amp;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">BACKEND_KQUEUE</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;((</span><span style="color: #0000BB">$socket_loop&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvLoop</span><span style="color: #007700">(</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">BACKEND_KQUEUE</span><span style="color: #007700">)))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$embed&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvEmbed</span><span style="color: #007700">(</span><span style="color: #0000BB">$loop</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;}<br>}<br><br>if&#xA0;(!</span><span style="color: #0000BB">$socket_loop</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$socket_loop&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$loop</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #FF8000">//&#xA0;Now&#xA0;use&#xA0;$socket_loop&#xA0;for&#xA0;all&#xA0;sockets,&#xA0;and&#xA0;$loop&#xA0;for&#xA0;anything&#xA0;else<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4165">
  <p><strong>Example #9 Handle SIGTERM signal</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvSignal</span><span style="color: #007700">(</span><span style="color: #0000BB">SIGTERM</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$watcher</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;SIGTERM&#xA0;received\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$watcher</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>});<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4166">
  <p><strong>Example #10 Monitor changes of /var/log/messages</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">//&#xA0;Use&#xA0;10&#xA0;second&#xA0;update&#xA0;interval.<br></span><span style="color: #0000BB">$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvStat</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;/var/log/messages&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">8</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;/var/log/messages&#xA0;changed\n&quot;</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$attr&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">attr</span><span style="color: #007700">();<br><br>&#xA0;&#xA0;&#xA0;&#xA0;if&#xA0;(</span><span style="color: #0000BB">$attr</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;nlink&apos;</span><span style="color: #007700">])&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;Current&#xA0;size:&#xA0;%ld\n&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$attr</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;size&apos;</span><span style="color: #007700">]);<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;Current&#xA0;atime:&#xA0;%ld\n&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$attr</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;atime&apos;</span><span style="color: #007700">]);<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;Current&#xA0;mtime:&#xA0;%ld\n&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$attr</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;mtime&apos;</span><span style="color: #007700">]);<br>&#xA0;&#xA0;&#xA0;&#xA0;}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">fprintf</span><span style="color: #007700">(</span><span style="color: #0000BB">STDERR</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;`messages`&#xA0;file&#xA0;is&#xA0;not&#xA0;there!&quot;</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;}<br>});<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4167">
  <p><strong>Example #11 Monotor changes of /var/log/messages. Avoid missing updates by means of one second delay</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$timer&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">EvTimer</span><span style="color: #007700">::</span><span style="color: #0000BB">createStopped</span><span style="color: #007700">(</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">1.02</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$stat&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">data</span><span style="color: #007700">;<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;1&#xA0;second&#xA0;after&#xA0;the&#xA0;most&#xA0;recent&#xA0;change&#xA0;of&#xA0;the&#xA0;file<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;Current&#xA0;size:&#xA0;%ld\n&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$stat</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">attr</span><span style="color: #007700">()[</span><span style="color: #DD0000">&apos;size&apos;</span><span style="color: #007700">]);<br>});<br><br></span><span style="color: #0000BB">$stat&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvStat</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;/var/log/messages&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">0.</span><span style="color: #007700">,&#xA0;function&#xA0;()&#xA0;use&#xA0;(</span><span style="color: #0000BB">$timer</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Reset&#xA0;timer&#xA0;watcher<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$timer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">again</span><span style="color: #007700">();<br>});<br><br></span><span style="color: #0000BB">$timer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">data&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$stat</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
 <div class="example" id="example-4168">
  <p><strong>Example #12 Process status changes</strong></p>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br>$pid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">pcntl_fork</span><span style="color: #007700">();<br><br>if&#xA0;(</span><span style="color: #0000BB">$pid&#xA0;</span><span style="color: #007700">==&#xA0;-</span><span style="color: #0000BB">1</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">fprintf</span><span style="color: #007700">(</span><span style="color: #0000BB">STDERR</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;pcntl_fork&#xA0;failed\n&quot;</span><span style="color: #007700">);<br>}&#xA0;elseif&#xA0;(</span><span style="color: #0000BB">$pid</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$w&#xA0;</span><span style="color: #007700">=&#xA0;new&#xA0;</span><span style="color: #0000BB">EvChild</span><span style="color: #007700">(</span><span style="color: #0000BB">$pid</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">FALSE</span><span style="color: #007700">,&#xA0;function&#xA0;(</span><span style="color: #0000BB">$w</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$revents</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">stop</span><span style="color: #007700">();<br><br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;Process&#xA0;%d&#xA0;exited&#xA0;with&#xA0;status&#xA0;%d\n&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rpid</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$w</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">rstatus</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;});<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">Ev</span><span style="color: #007700">::</span><span style="color: #0000BB">run</span><span style="color: #007700">();<br><br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;Protect&#xA0;against&#xA0;Zombies<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">pcntl_wait</span><span style="color: #007700">(</span><span style="color: #0000BB">$status</span><span style="color: #007700">);<br>}&#xA0;else&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//Forked&#xA0;child<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">exit(</span><span style="color: #0000BB">2</span><span style="color: #007700">);<br>}<br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
