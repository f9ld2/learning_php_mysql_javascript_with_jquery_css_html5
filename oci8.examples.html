---
layout: default
---

 <h1>Examples</h1>

 <p class="para">
  These examples connect as the <em>HR</em> user, which is
  the sample &quot;Human Resources&quot; schema supplied with the
  Oracle database. The account may need to be unlocked and the
  password reset before you can use it.
 </p>

 <p class="para">
  The examples connect to the <em>XE</em> database on your
  machine.  Change the connect string to your database before running
  the examples.
 </p>

 <div class="example" id="example-2180">
  <p><strong>Example #1 Basic query</strong></p>
  <div class="example-contents"><p>
   This shows querying and displaying results.  Statements in OCI8 use
   a prepare-execute-fetch sequence of steps.
  </p></div>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$conn&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;hr&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;welcome&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;localhost/XE&apos;</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$e&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">],&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #FF8000">//&#xA0;Prepare&#xA0;the&#xA0;statement<br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;SELECT&#xA0;*&#xA0;FROM&#xA0;departments&apos;</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$stid</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$e&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">],&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #FF8000">//&#xA0;Perform&#xA0;the&#xA0;logic&#xA0;of&#xA0;the&#xA0;query<br></span><span style="color: #0000BB">$r&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$r</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$e&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">],&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #FF8000">//&#xA0;Fetch&#xA0;the&#xA0;results&#xA0;of&#xA0;the&#xA0;query<br></span><span style="color: #007700">print&#xA0;</span><span style="color: #DD0000">&quot;&lt;table&#xA0;border=&apos;1&apos;&gt;\n&quot;</span><span style="color: #007700">;<br>while&#xA0;(</span><span style="color: #0000BB">$row&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">+</span><span style="color: #0000BB">OCI_RETURN_NULLS</span><span style="color: #007700">))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;print&#xA0;</span><span style="color: #DD0000">&quot;&lt;tr&gt;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;foreach&#xA0;(</span><span style="color: #0000BB">$row&#xA0;</span><span style="color: #007700">as&#xA0;</span><span style="color: #0000BB">$item</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;print&#xA0;</span><span style="color: #DD0000">&quot;&#xA0;&#xA0;&#xA0;&#xA0;&lt;td&gt;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;(</span><span style="color: #0000BB">$item&#xA0;</span><span style="color: #007700">!==&#xA0;</span><span style="color: #0000BB">null&#xA0;</span><span style="color: #007700">?&#xA0;</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$item</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">)&#xA0;:&#xA0;</span><span style="color: #DD0000">&quot;&amp;nbsp;&quot;</span><span style="color: #007700">)&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;&lt;/td&gt;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;print&#xA0;</span><span style="color: #DD0000">&quot;&lt;/tr&gt;\n&quot;</span><span style="color: #007700">;<br>}<br>print&#xA0;</span><span style="color: #DD0000">&quot;&lt;/table&gt;\n&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>

 <div class="example" id="example-2181">
  <p><strong>Example #2 Inserting with bind variables</strong></p>
  <div class="example-contents"><p>
   Bind variables improve performance by allowing reuse of execution
   contexts and caches.  Bind variables improve security by preventing
   some kinds of SQL Injection problems.
  </p></div>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">//&#xA0;Before&#xA0;running,&#xA0;create&#xA0;the&#xA0;table:<br>//&#xA0;&#xA0;&#xA0;CREATE&#xA0;TABLE&#xA0;MYTABLE&#xA0;(mid&#xA0;NUMBER,&#xA0;myd&#xA0;VARCHAR2(20));<br><br></span><span style="color: #0000BB">$conn&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;hr&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;welcome&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;localhost/XE&apos;</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$e&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">],&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;INSERT&#xA0;INTO&#xA0;MYTABLE&#xA0;(mid,&#xA0;myd)&#xA0;VALUES(:myid,&#xA0;:mydata)&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$id&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">60</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$data&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&apos;Some&#xA0;data&apos;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;:myid&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;:mydata&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$r&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;executes&#xA0;and&#xA0;commits<br><br></span><span style="color: #007700">if&#xA0;(</span><span style="color: #0000BB">$r</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;print&#xA0;</span><span style="color: #DD0000">&quot;One&#xA0;row&#xA0;inserted&quot;</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>

 <div class="example" id="example-2182">
  <p><strong>Example #3 Binding in the WHERE clause of a query</strong></p>
  <div class="example-contents"><p>
   This shows a single scalar bind.
  </p></div>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br>$conn&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;hr&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;hrpwd&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;localhost/XE&quot;</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$m&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">]),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$sql&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&apos;SELECT&#xA0;last_name&#xA0;FROM&#xA0;employees&#xA0;WHERE&#xA0;department_id&#xA0;=&#xA0;:didbv&#xA0;ORDER&#xA0;BY&#xA0;last_name&apos;</span><span style="color: #007700">;<br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$didbv&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">60</span><span style="color: #007700">;<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;:didbv&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$didbv</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br>while&#xA0;((</span><span style="color: #0000BB">$row&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">))&#xA0;!=&#xA0;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;LAST_NAME&apos;</span><span style="color: #007700">]&#xA0;.</span><span style="color: #DD0000">&quot;&lt;br&gt;\n&quot;</span><span style="color: #007700">;<br>}<br><br></span><span style="color: #FF8000">//&#xA0;Output&#xA0;is<br>//&#xA0;&#xA0;&#xA0;&#xA0;Austin<br>//&#xA0;&#xA0;&#xA0;&#xA0;Ernst<br>//&#xA0;&#xA0;&#xA0;&#xA0;Hunold<br>//&#xA0;&#xA0;&#xA0;&#xA0;Lorentz<br>//&#xA0;&#xA0;&#xA0;&#xA0;Pataballa<br><br></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>

 <div class="example" id="example-2183">
  <p><strong>Example #4 Inserting and fetching a CLOB</strong></p>
  <div class="example-contents"><p>
   For large data use binary long object (BLOB) or character long
   object (CLOB) types.  This example uses CLOB.
  </p></div>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">//&#xA0;Before&#xA0;running,&#xA0;create&#xA0;the&#xA0;table:<br>//&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;CREATE&#xA0;TABLE&#xA0;MYTABLE&#xA0;(mykey&#xA0;NUMBER,&#xA0;myclob&#xA0;CLOB);<br><br></span><span style="color: #0000BB">$conn&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;hr&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;welcome&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;localhost/XE&apos;</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$e&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">],&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$mykey&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">12343</span><span style="color: #007700">;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;arbitrary&#xA0;key&#xA0;for&#xA0;this&#xA0;example;<br><br></span><span style="color: #0000BB">$sql&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&quot;INSERT&#xA0;INTO&#xA0;mytable&#xA0;(mykey,&#xA0;myclob)<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;VALUES&#xA0;(:mykey,&#xA0;EMPTY_CLOB())<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RETURNING&#xA0;myclob&#xA0;INTO&#xA0;:myclob&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$sql</span><span style="color: #007700">);<br></span><span style="color: #0000BB">$clob&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_new_descriptor</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_D_LOB</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;:mykey&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$mykey</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;:myclob&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$clob</span><span style="color: #007700">,&#xA0;-</span><span style="color: #0000BB">1</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_B_CLOB</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_NO_AUTO_COMMIT</span><span style="color: #007700">);&#xA0;</span><span style="color: #FF8000">//&#xA0;use&#xA0;OCI_DEFAULT&#xA0;for&#xA0;PHP&#xA0;&lt;=&#xA0;5.3.1<br></span><span style="color: #0000BB">$clob</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">save</span><span style="color: #007700">(</span><span style="color: #DD0000">&quot;A&#xA0;very&#xA0;long&#xA0;string&quot;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">oci_commit</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br><br></span><span style="color: #FF8000">//&#xA0;Fetching&#xA0;CLOB&#xA0;data<br><br></span><span style="color: #0000BB">$query&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #DD0000">&apos;SELECT&#xA0;myclob&#xA0;FROM&#xA0;mytable&#xA0;WHERE&#xA0;mykey&#xA0;=&#xA0;:mykey&apos;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse&#xA0;</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&quot;:mykey&quot;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$mykey</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">5</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br><br>print&#xA0;</span><span style="color: #DD0000">&apos;&lt;table&#xA0;border=&quot;1&quot;&gt;&apos;</span><span style="color: #007700">;<br>while&#xA0;(</span><span style="color: #0000BB">$row&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">+</span><span style="color: #0000BB">OCI_RETURN_LOBS</span><span style="color: #007700">))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;print&#xA0;</span><span style="color: #DD0000">&apos;&lt;tr&gt;&lt;td&gt;&apos;</span><span style="color: #007700">.</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;MYCLOB&apos;</span><span style="color: #007700">].</span><span style="color: #DD0000">&apos;&lt;/td&gt;&lt;/tr&gt;&apos;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;In&#xA0;a&#xA0;loop,&#xA0;freeing&#xA0;the&#xA0;large&#xA0;variable&#xA0;before&#xA0;the&#xA0;2nd&#xA0;fetch&#xA0;reduces&#xA0;PHP&apos;s&#xA0;peak&#xA0;memory&#xA0;usage<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">unset(</span><span style="color: #0000BB">$row</span><span style="color: #007700">);&#xA0;&#xA0;<br>}<br>print&#xA0;</span><span style="color: #DD0000">&apos;&lt;/table&gt;&apos;</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>

 <div class="example" id="example-2184">
  <p><strong>Example #5 Using a PL/SQL stored function</strong></p>
  <div class="example-contents"><p>
   You must bind a variable for the return value and optionally for
   any PL/SQL function arguments.
  </p></div>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">/*<br>&#xA0;&#xA0;Before&#xA0;running&#xA0;the&#xA0;PHP&#xA0;program,&#xA0;create&#xA0;a&#xA0;stored&#xA0;function&#xA0;in<br>&#xA0;&#xA0;SQL*Plus&#xA0;or&#xA0;SQL&#xA0;Developer:<br><br>&#xA0;&#xA0;CREATE&#xA0;OR&#xA0;REPLACE&#xA0;FUNCTION&#xA0;myfunc(p&#xA0;IN&#xA0;NUMBER)&#xA0;RETURN&#xA0;NUMBER&#xA0;AS<br>&#xA0;&#xA0;BEGIN<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RETURN&#xA0;p&#xA0;*&#xA0;3;<br>&#xA0;&#xA0;END;<br><br>*/<br><br></span><span style="color: #0000BB">$conn&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;hr&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;welcome&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;localhost/XE&apos;</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$e&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">],&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$p&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">8</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;begin&#xA0;:r&#xA0;:=&#xA0;myfunc(:p);&#xA0;end;&apos;</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;:p&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$p</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;:r&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$r</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">40</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br><br>print&#xA0;</span><span style="color: #DD0000">&quot;</span><span style="color: #0000BB">$r</span><span style="color: #DD0000">\n&quot;</span><span style="color: #007700">;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;prints&#xA0;24<br><br></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>

 <div class="example" id="example-2185">
  <p><strong>Example #6 Using a PL/SQL stored procedure</strong></p>
  <div class="example-contents"><p>
   With stored procedures, you should bind variables for any arguments.
  </p></div>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br><br></span><span style="color: #FF8000">/*<br>&#xA0;&#xA0;Before&#xA0;running&#xA0;the&#xA0;PHP&#xA0;program,&#xA0;create&#xA0;a&#xA0;stored&#xA0;procedure&#xA0;in<br>&#xA0;&#xA0;SQL*Plus&#xA0;or&#xA0;SQL&#xA0;Developer:<br><br>&#xA0;&#xA0;CREATE&#xA0;OR&#xA0;REPLACE&#xA0;PROCEDURE&#xA0;myproc(p1&#xA0;IN&#xA0;NUMBER,&#xA0;p2&#xA0;OUT&#xA0;NUMBER)&#xA0;AS<br>&#xA0;&#xA0;BEGIN<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;p2&#xA0;:=&#xA0;p1&#xA0;*&#xA0;2;<br>&#xA0;&#xA0;END;<br><br>*/<br><br></span><span style="color: #0000BB">$conn&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;hr&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;welcome&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;localhost/XE&apos;</span><span style="color: #007700">);<br>if&#xA0;(!</span><span style="color: #0000BB">$conn</span><span style="color: #007700">)&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$e&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_error</span><span style="color: #007700">();<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #0000BB">htmlentities</span><span style="color: #007700">(</span><span style="color: #0000BB">$e</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;message&apos;</span><span style="color: #007700">],&#xA0;</span><span style="color: #0000BB">ENT_QUOTES</span><span style="color: #007700">),&#xA0;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br>}<br><br></span><span style="color: #0000BB">$p1&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">8</span><span style="color: #007700">;<br><br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;begin&#xA0;myproc(:p1,&#xA0;:p2);&#xA0;end;&apos;</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;:p1&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$p1</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_bind_by_name</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;:p2&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">$p2</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">40</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br><br>print&#xA0;</span><span style="color: #DD0000">&quot;</span><span style="color: #0000BB">$p2</span><span style="color: #DD0000">\n&quot;</span><span style="color: #007700">;&#xA0;&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;prints&#xA0;16<br><br></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>

 <div class="example" id="example-2186">
  <p><strong>Example #7 Calling a PL/SQL function that returns a <em>REF CURSOR</em></strong></p>
  <div class="example-contents"><p>
   Each returned value from the query is a <em>REF
   CURSOR</em> that can be fetched from.
  </p></div>
  <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br></span><span style="color: #FF8000">/*<br>&#xA0;&#xA0;Create&#xA0;the&#xA0;PL/SQL&#xA0;stored&#xA0;function&#xA0;as:<br><br>&#xA0;&#xA0;CREATE&#xA0;OR&#xA0;REPLACE&#xA0;FUNCTION&#xA0;myfunc(p1&#xA0;IN&#xA0;NUMBER)&#xA0;RETURN&#xA0;SYS_REFCURSOR&#xA0;AS<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;rc&#xA0;SYS_REFCURSOR;<br>&#xA0;&#xA0;BEGIN<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;OPEN&#xA0;rc&#xA0;FOR&#xA0;SELECT&#xA0;city&#xA0;FROM&#xA0;locations&#xA0;WHERE&#xA0;ROWNUM&#xA0;&lt;&#xA0;p1;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;RETURN&#xA0;rc;<br>&#xA0;&#xA0;END;<br>*/<br><br></span><span style="color: #0000BB">$conn&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">&apos;hr&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;welcome&apos;</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;localhost/XE&apos;</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">$stid&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">,&#xA0;</span><span style="color: #DD0000">&apos;SELECT&#xA0;myfunc(5)&#xA0;AS&#xA0;mfrc&#xA0;FROM&#xA0;dual&apos;</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br><br>echo&#xA0;</span><span style="color: #DD0000">&quot;&lt;table&#xA0;border=&apos;1&apos;&gt;\n&quot;</span><span style="color: #007700">;<br>while&#xA0;((</span><span style="color: #0000BB">$row&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">)))&#xA0;{<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;&lt;tr&gt;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">$rc&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">$row</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;MFRC&apos;</span><span style="color: #007700">];<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">oci_execute</span><span style="color: #007700">(</span><span style="color: #0000BB">$rc</span><span style="color: #007700">);&#xA0;&#xA0;</span><span style="color: #FF8000">//&#xA0;returned&#xA0;column&#xA0;value&#xA0;from&#xA0;the&#xA0;query&#xA0;is&#xA0;a&#xA0;ref&#xA0;cursor<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #007700">while&#xA0;((</span><span style="color: #0000BB">$rc_row&#xA0;</span><span style="color: #007700">=&#xA0;</span><span style="color: #0000BB">oci_fetch_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$rc</span><span style="color: #007700">,&#xA0;</span><span style="color: #0000BB">OCI_ASSOC</span><span style="color: #007700">)))&#xA0;{&#xA0;&#xA0;&#xA0;<br>&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;&#xA0;&#xA0;&#xA0;&#xA0;&lt;td&gt;&quot;&#xA0;</span><span style="color: #007700">.&#xA0;</span><span style="color: #0000BB">$rc_row</span><span style="color: #007700">[</span><span style="color: #DD0000">&apos;CITY&apos;</span><span style="color: #007700">]&#xA0;.&#xA0;</span><span style="color: #DD0000">&quot;&lt;/td&gt;\n&quot;</span><span style="color: #007700">;<br>&#xA0;&#xA0;&#xA0;&#xA0;}<br>&#xA0;&#xA0;&#xA0;&#xA0;</span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$rc</span><span style="color: #007700">);<br>&#xA0;&#xA0;&#xA0;&#xA0;echo&#xA0;</span><span style="color: #DD0000">&quot;&lt;/tr&gt;\n&quot;</span><span style="color: #007700">;<br>}<br>echo&#xA0;</span><span style="color: #DD0000">&quot;&lt;/table&gt;\n&quot;</span><span style="color: #007700">;<br><br></span><span style="color: #FF8000">//&#xA0;Output&#xA0;is:<br>//&#xA0;&#xA0;&#xA0;Beijing<br>//&#xA0;&#xA0;&#xA0;Bern<br>//&#xA0;&#xA0;&#xA0;Bombay<br>//&#xA0;&#xA0;&#xA0;Geneva<br><br></span><span style="color: #0000BB">oci_free_statement</span><span style="color: #007700">(</span><span style="color: #0000BB">$stid</span><span style="color: #007700">);<br></span><span style="color: #0000BB">oci_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">);<br><br></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
  </div>

 </div>
